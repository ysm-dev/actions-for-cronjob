<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>eomdev's blog</title>
    <description>배움을 좋아하고, 많고 다양한 경험을 해보기를 원합니다.
</description>
    <link>http://blog.eomdev.com/</link>
    <atom:link href="http://blog.eomdev.com/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Mon, 01 Apr 2019 13:22:31 +0000</pubDate>
    <lastBuildDate>Mon, 01 Apr 2019 13:22:31 +0000</lastBuildDate>
    <generator>Jekyll v3.7.4</generator>
    
      <item>
        <title>Spring Cloud Bus</title>
        <description>&lt;p&gt;Spring Cloud Bus에 대해서 알아봅니다.&lt;/p&gt;

&lt;p&gt;관련 예제는 Github에 있습니다.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/umsh86/blog-samples/tree/master/config-repo&quot;&gt;Config-Repo&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/umsh86/blog-samples/tree/master/config-server&quot;&gt;Config-Server&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/umsh86/blog-samples/tree/master/config-client&quot;&gt;Config-Client&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;이 전 &lt;a href=&quot;http://blog.eomdev.com/springcloud/2019/03/21/Spring-Cloud-Config.html&quot;&gt;Spring Cloud Config&lt;/a&gt;에서도 이야기 했듯이, &lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Config Server&lt;/code&gt;를 사용하면 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client(MSA)&lt;/code&gt; 애플리케이션을 수정하거나 재시작 하지 않아도 변경된 환경설정 정보들을 적용할 수 있습니다.
하지만, 변경된 환경설정 정보를 다시 적용시키기 위해서는 각각의 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt; 인스턴스들에게 각각 Actuator의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/refresh&lt;/code&gt;를 호출을 해줘야한다는 단점이 있었습니다.&lt;/p&gt;

&lt;h1 id=&quot;1-spring-cloud-bus&quot;&gt;1. Spring Cloud Bus?&lt;/h1&gt;

&lt;p&gt;위에서 이야기한 각각의 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt; 인스턴스마다 &lt;code class=&quot;highlighter-rouge&quot;&gt;/actuator/refresh&lt;/code&gt;를 호출해줘야하는 단점은 &lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Bus&lt;/code&gt;를 통해서 하나의 &lt;code class=&quot;highlighter-rouge&quot;&gt;메시지 브로커(여기서는 RabbitMQ)&lt;/code&gt;에 모든 인스턴스들을 연결해서 해결할 수가 있습니다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/55203234-18c38f80-520e-11e9-8a26-80d4eba89558.png&quot; alt=&quot;스크린샷 2019-03-29 오전 10 32 15&quot; /&gt;&lt;/p&gt;

&lt;p&gt;개념은 위의 그림과 같고, 간단하게 설명하자면 아래와 같습니다.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;개발자가 변경할 프로퍼티를 수정하고, 변경된 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Repo&lt;/code&gt;를 Git Repository에 push 합니다.&lt;/li&gt;
  &lt;li&gt;만약 Git Repository로 Github와 같은 저장소를 사용하고 있다면, Git Repository에 변경이 일어났을 때 webhook 으로 특정 url을 호출할 수 있습니다. 이 때 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Server&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/actuator/bus-refresh&lt;/code&gt;를 POST로 호출하도록 해주면 되는데, 여기서는 webhook을 사용하지 않고 직접 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Server&lt;/code&gt;에 url을 호출해주도록 하겠습니다.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/actuator/bus-refresh&lt;/code&gt;를 통해서 변경되었음을 통보받은 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Server&lt;/code&gt;는 변경된 환경설정 정보를 다시 갱신합니다.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Bus&lt;/code&gt;가 변경된 정보가 있다고 RabbitMQ에게 메시지를 발행합니다.&lt;/li&gt;
  &lt;li&gt;메시지를 구독받은 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;들은 환경설정 정보가 변경되었음을 알게 되고, 각각 환경설정 정보를 업데이트 합니다.&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;2-config-server-수정&quot;&gt;2. Config Server 수정&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Server&lt;/code&gt; 프로젝트에 &lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Bus&lt;/code&gt;를 사용하기 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;spring-cloud-starter-bus-amqp&lt;/code&gt;  디펜던시를 추가해주어야 합니다.&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;implementation&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'org.springframework.cloud:spring-cloud-starter-bus-amqp'&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 추가&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 &lt;code class=&quot;highlighter-rouge&quot;&gt;application.yml&lt;/code&gt;에 &lt;code class=&quot;highlighter-rouge&quot;&gt;RabbitMQ&lt;/code&gt; 정보와 &lt;code class=&quot;highlighter-rouge&quot;&gt;actuator&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/bus-refresh&lt;/code&gt;를 사용가능하도록 노출시켜 주기 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;management.endpoints.web.exposure.include&lt;/code&gt;에 등록해줍니다.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;active&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;native&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;8888&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;native&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cloud&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;native&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;search-locations&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;file://${user.home}/IdeaProjects/study/blog-samples/config-repo&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;                   &lt;span class=&quot;c1&quot;&gt;# rabbitmq와 관련된 부분 추가&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;192.168.99.100&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;guest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;guest&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;management&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;endpoints&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;base-path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/actuator&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;exposure&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bus-refresh'&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# actuator의 bus-refresh endpoint 노출시켜줍니다&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cloud&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;git&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;https://github.com/umsh86/blog-samples.git&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;search-paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;config-repo&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;3-config-client-수정&quot;&gt;3. Config Client 수정&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Server&lt;/code&gt;와 마찬가지로 &lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Bus&lt;/code&gt;를 사용하기 위해서 디펜던시를 아래와 같이 추가해줍니다.&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;implementation&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'org.springframework.cloud:spring-cloud-starter-bus-amqp'&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 추가&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 이번에는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Repo&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;api.yml&lt;/code&gt;에 &lt;code class=&quot;highlighter-rouge&quot;&gt;RabbitMQ 정보&lt;/code&gt;를 수정해주고, 테스트를 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;server.port&lt;/code&gt;를 삭제해줍니다(Config Client를 로컬에 2개 띄울 예정이며, &lt;code class=&quot;highlighter-rouge&quot;&gt;-Dserver.port&lt;/code&gt;옵션으로 port 중복을 회피하기 위해서 입니다).&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;# RabbitMQ 정보 수정&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;192.168.99.100&lt;/span&gt;   
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;guest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;guest&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# server:&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#   port: 9998&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api-dev!&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;4-테스트&quot;&gt;4. 테스트&lt;/h1&gt;

&lt;p&gt;위의 내용을 모두 수정했으면, 우선 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Server&lt;/code&gt;를 실행시켜 줍니다. 애플리케이션이 정상적으로 실행되고 나면 RabbitMQ managerment &amp;gt; Exchanges 에 &lt;code class=&quot;highlighter-rouge&quot;&gt;springCloudBus&lt;/code&gt;가 추가된 것을 볼 수 있습니다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/55054359-e6e1ea00-50a2-11e9-84fa-e4a35dd15a9b.png&quot; alt=&quot;스크린샷 2019-03-27 오후 3 09 30&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그리고 이번에는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Client&lt;/code&gt;프로젝트를 빌드하고, 생성된 jar 파일을 각각 9999와 9998 포트로 실행합니다.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;java &lt;span class=&quot;nt&quot;&gt;-jar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Dserver&lt;/span&gt;.port&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;9999 config-client-0.0.1-SNAPSHOT.jar
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;java &lt;span class=&quot;nt&quot;&gt;-jar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Dserver&lt;/span&gt;.port&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;9998 config-client-0.0.1-SNAPSHOT.jar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;정상적으로 실행이 되면, 각각의 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Client&lt;/code&gt; 인스턴스에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;custom.message&lt;/code&gt;가 정상적으로 나오는지 &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:9999/config&lt;/code&gt;와 &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:9999/config&lt;/code&gt; 을 호출해서 확인해봅니다.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Hello, api-dev!&lt;/code&gt;라는 메시지가 정상적으로 나오는 것을 확인할 수 있습니다.&lt;/p&gt;

&lt;p&gt;그리고 local &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Repo&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;api.yml&lt;/code&gt;에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;custom.message&lt;/code&gt;의 내용을 변경해줍니다.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;192.168.99.100&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;guest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;guest&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api-dev! Cloud Bus Test!!&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# Cloud Bus Test!! 메시지를 추가했습니다.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Server&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/actuator/bus-refresh&lt;/code&gt;를 &lt;code class=&quot;highlighter-rouge&quot;&gt;POST&lt;/code&gt;로 호출해줍니다. 저는 InteliiJ의 &lt;a href=&quot;http://blog.eomdev.com/intellij/2019/01/21/Intellij_http_client.html&quot;&gt;Http Client&lt;/a&gt;를 사용해서 호출해주었습니다.&lt;/p&gt;

&lt;div class=&quot;language-http highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;POST http://localhost:9998/actuator/bus-refresh

HTTP/1.1 204 
Date: Fri, 29 Mar 2019 05:56:22 GMT

&amp;lt;Response body is empty&amp;gt;

Response code: 204; Time: 970ms; Content length: 0 bytes
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;아래는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;의 console 로그 입니다.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2019-03-29 14:56:22.028  INFO 11736 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;nio-8888-exec-6] trationDelegate&lt;span class=&quot;nv&quot;&gt;$BeanPostProcessorChecker&lt;/span&gt; : Bean &lt;span class=&quot;s1&quot;&gt;'org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration'&lt;/span&gt; of &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration&lt;span class=&quot;nv&quot;&gt;$$&lt;/span&gt;EnhancerBySpringCGLIB&lt;span class=&quot;nv&quot;&gt;$$&lt;/span&gt;38bc02b3] is not eligible &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;getting processed by all BeanPostProcessors &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;example: not eligible &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;auto-proxying&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
2019-03-29 14:56:22.154  INFO 11736 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;nio-8888-exec-6] o.s.boot.SpringApplication               : The following profiles are active: native
2019-03-29 14:56:22.174  INFO 11736 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;nio-8888-exec-6] o.s.boot.SpringApplication               : Started application &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.491 seconds &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;JVM running &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;1888.348&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
2019-03-29 14:56:22.471  INFO 11736 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;nio-8888-exec-7] o.s.c.c.s.e.NativeEnvironmentRepository  : Adding property &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;: file:///Users/sheom/IdeaProjects/study/blog-samples/config-repo/api.yml &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;document &lt;span class=&quot;c&quot;&gt;#0)&lt;/span&gt;
2019-03-29 14:56:22.529  INFO 11736 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;nio-8888-exec-6] o.s.cloud.bus.event.RefreshListener      : Received remote refresh request. Keys refreshed &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;아래는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;의 로그입니다.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2019-03-29 14:56:22.486  INFO 11833 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;7e5Xfw4e8qNZg-1] o.s.boot.SpringApplication               : The following profiles are active: dev
2019-03-29 14:56:22.524  INFO 11833 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;7e5Xfw4e8qNZg-1] o.s.boot.SpringApplication               : Started application &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.611 seconds &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;JVM running &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;806.562&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
2019-03-29 14:56:22.828  INFO 11833 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;7e5Xfw4e8qNZg-1] o.s.cloud.bus.event.RefreshListener      : Received remote refresh request. Keys refreshed &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;custom.message]
2019-03-29 14:56:22.924  INFO 11833 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;7e5Xfw4e8qNZg-1] o.s.a.r.c.CachingConnectionFactory       : Attempting to connect to: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.99.100:5672]
2019-03-29 14:56:22.948  INFO 11833 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;7e5Xfw4e8qNZg-1] o.s.a.r.c.CachingConnectionFactory       : Created new connection: rabbitConnectionFactory.publisher#35b2d39c:0/SimpleConnection@41f917fb &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;delegate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amqp://guest@192.168.99.100:5672/, &lt;span class=&quot;nv&quot;&gt;localPort&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 64087]

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 각각의 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Client&lt;/code&gt; 인스턴스에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;/config&lt;/code&gt;를 호출해 보면 둘 다 &lt;code class=&quot;highlighter-rouge&quot;&gt;Hello, api-dev! Cloud Bus Test!!&lt;/code&gt;메시지가 나오는 것을 확인할 수 있습니다.&lt;/p&gt;

&lt;p&gt;이렇게 해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/actuator/bus-refresh&lt;/code&gt;만을 호출해서 구독하고 있는 모든 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt; 인스턴스들에게 한 번에 변경된 환경설정 정보를 변경할 수 있다는 것을 확인할 수 있었습니다.&lt;/p&gt;

&lt;p&gt;실제로는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Github&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;Webhook&lt;/code&gt;을 사용해서 자동으로 호출하게 할 수 있으므로 직접 &lt;code class=&quot;highlighter-rouge&quot;&gt;/actuator/bus-refresh&lt;/code&gt;를 호출해주는 작업도 필요하지 않습니다.&lt;/p&gt;

&lt;p&gt;다음에는 Config Server의 고가용성에 대한 이야기를 정리해보겠습니다.&lt;/p&gt;

&lt;h1 id=&quot;5-config-server-고가용성-적용&quot;&gt;5. Config Server 고가용성 적용&lt;/h1&gt;

&lt;p&gt;Config Server의 고가용성 확보를 위한 아키텍처는 아래와 같습니다.&lt;/p&gt;

&lt;p&gt;그리고 &lt;code class=&quot;highlighter-rouge&quot;&gt;config Server&lt;/code&gt;를 구성할 때 고가용성에 대해서 고려해야하는 부분은 총 3가지로 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;RabbitMQ&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Repo(Git Repository)&lt;/code&gt;입니다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/55304951-0f922700-5489-11e9-98aa-db2e4572dc4f.png&quot; alt=&quot;스크린샷 2019-04-01 오후 2 17 10&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;51-config-server&quot;&gt;5.1 Config Server&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;에 장애가 발생하면 환경설정 정보를 읽어서 사용하는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;서비스들이 정상적으로 실행될 수 없으므로, 고가용성이 필요합니다.&lt;/p&gt;

&lt;p&gt;하지만, &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;에 장애가 발생하더라도 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;가 이미 정상적으로 작동되고 있는 상태라면 로컬에 캐시해둔 환경설정 정보를 기준으로 동작하기 때문에 크게 문제가 되지 않습니다(물론 새로 애플리케이션이 실행된다면 문제…).&lt;/p&gt;

&lt;p&gt;다만, &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootstrap.yml&lt;/code&gt;에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;spring.cloud.config.uri&lt;/code&gt;는 하나만 설정할 수 있으므로, 다수의 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;에 대한 정보는 로드 밸런서와 같은 곳에 저장돼야 합니다.&lt;/p&gt;

&lt;p&gt;그래서 위의 아키텍처에서는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;들이 &lt;code class=&quot;highlighter-rouge&quot;&gt;ELB&lt;/code&gt;를 통해 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;를 호출하는 형태입니다.&lt;/p&gt;

&lt;h2 id=&quot;52-rabbitmq&quot;&gt;5.2 RabbitMQ&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;RabbitMQ&lt;/code&gt;의 경우에도 고가용성이 적용되야하지만, &lt;code class=&quot;highlighter-rouge&quot;&gt;RabbitMQ&lt;/code&gt;에 장애가 발생하더라도, 각각의 마이크로서비스 인스턴스의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/actuator/refresh&lt;/code&gt;를 직접 호출해서 변경된 환경설정 정보를 가져올 수 있으므로 크게 문제는 되지 않습니다.&lt;/p&gt;

&lt;h2 id=&quot;53-git-repository&quot;&gt;5.3 Git Repository&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Git Repository&lt;/code&gt;의 경우에도 로컬의 파일 기반의 Repository를 사용하는 것보다는 고가용성이 확보된 Git 서비스를 기반으로 운영돼야 합니다.&lt;/p&gt;

&lt;h1 id=&quot;6-정리&quot;&gt;6. 정리&lt;/h1&gt;

&lt;p&gt;이렇게 해서 지난 번에 &lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Server&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Client&lt;/code&gt;에 대해서 다뤘고, 이번에는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Bus&lt;/code&gt;와 &lt;code class=&quot;highlighter-rouge&quot;&gt;고가용성&lt;/code&gt;에 대해서 정리를 해보았습니다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;참고 : 스프링 5.0 마이크로서비스 2/e (에이콘출판사)&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        <pubDate>Mon, 01 Apr 2019 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/springcloud/2019/04/01/Spring-Cloud-Bus.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/springcloud/2019/04/01/Spring-Cloud-Bus.html</guid>
        
        
        <category>SpringCloud</category>
        
      </item>
    
      <item>
        <title>Spring Cloud Config</title>
        <description>&lt;p&gt;Spring Cloud Config Server에 대해서 알아봅니다.&lt;/p&gt;

&lt;p&gt;관련 예제는 Github에 있습니다.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/umsh86/blog-samples/tree/master/config-repo&quot;&gt;Config-Repo&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/umsh86/blog-samples/tree/master/config-server&quot;&gt;Config-Server&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/umsh86/blog-samples/tree/master/config-client&quot;&gt;Config-Client&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-spring-cloud-config-server&quot;&gt;1. Spring Cloud Config Server?&lt;/h1&gt;

&lt;p&gt;일반적인 Spring Boot Application 이라면 환경설정과 관련된 부분들은 해당 프로젝트에 함께 포함되어 있는 yml이나 properties 파일들을 읽어서 사용을 했었습니다.&lt;/p&gt;

&lt;p&gt;하지만 이 경우에 어떤 이유에서 환경설정 정보가 변경된다면(예를 들어, 환경설정 정보에 저장되어 있는 rabbitmq의 host와 password가 변경되어  &lt;code class=&quot;highlighter-rouge&quot;&gt;spring.rabbitmq.host&lt;/code&gt;와 &lt;code class=&quot;highlighter-rouge&quot;&gt;spring.rabbitmq.password&lt;/code&gt; 정보를 수정해야되는 경우), 애플리케이션 전체를 다시 빌드를 해야된다는 문제점이 있습니다.&lt;/p&gt;

&lt;p&gt;그래서 사실 dev, st, prod 환경에서는 아래와 같이 애플리케이션 배포 패키지에서 분리해서 외부화하기 위해서 환경설정 파일의 위치를 직접 지정해주면서 실행시켜서 사용하고 있었습니다.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;java &lt;span class=&quot;nt&quot;&gt;-jar&lt;/span&gt; application.jar &lt;span class=&quot;nt&quot;&gt;--spring&lt;/span&gt;.config.location&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;file location&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;하지만 이 방법도 서버에 마운트돼 있는 로컬이나 공유된 파일 시스템에 의존하게 되고, 대규모 배포에서는 더 강력한 중앙 집중형 환경설정 정보 관리 솔루션이 필요합니다.&lt;/p&gt;

&lt;p&gt;그것이 바로 &lt;code class=&quot;highlighter-rouge&quot;&gt;환경설정 서버&lt;/code&gt;인데, Spring Cloud Project에서 환경설정 서버를 만들 수 있도록 지원하고 있는 것들이 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;ZooKeeper Configuration&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Consul Configuration&lt;/code&gt;이 존재하는데, 여기에서는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt; 만 알아볼 예정입니다.&lt;/p&gt;

&lt;p&gt;Spring Config Server의 아키텍처는 아래와 같습니다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/54416946-2ffd7a00-4744-11e9-9403-f4902698917a.png&quot; alt=&quot;스크린샷 2019-03-15 오후 5 02 35&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;는 환경설정 정보들을 &lt;code class=&quot;highlighter-rouge&quot;&gt;Git Repository&lt;/code&gt;(SVN도 가능)에 저장되어 있는 환경설정 정보 파일들(yml 또는 properties)들을 읽습니다.&lt;/p&gt;

&lt;p&gt;그리고 각각의 마이크로서비스 애플리케이션들(Config Client)은 필요한 환경설정 정보들을 Config Server에서 읽어서 가져오며, 로컬에 캐시해둡니다. 여기에서 Config Server는 환경설정 정보가 변경되면(위의 예제처럼 rabbitmq의 host와 password가 변경되면) Config Server를 바라보고 있는 모든 마이크로서비스에게 변경 사항들을 전파하고, 변경 사항을 로컬 캐시에 반영하게 됩니다.&lt;/p&gt;

&lt;h1 id=&quot;2-git-repository-구성&quot;&gt;2. Git Repository 구성&lt;/h1&gt;

&lt;p&gt;그러면 우선 Config Server가 읽어서 사용할 Git Repository를 생성해주어야 합니다.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;config-repo&lt;/code&gt;라는 새로운 디렉토리를 생성하고 그 하위에 아래와 같은 작업을 진행해주었습니다.&lt;/p&gt;

&lt;p&gt;우선 Config Server가 직접 사용할 환경설정 정보를 추가해줍니다. 파일명은 application.yml 입니다.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;192.168.99.100&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;guest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;guest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtual-host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vhost01&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 마이크로서비스1, 2, 3이 dev, st, prod 에서 사용할 api-dev.yml, api-st.yml, api-prod.yml 을 각각 생성해줍니다&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# api-dev.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev.eomdev.com&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;devUser&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;devPassword&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtual-host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vhost01&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;9998&lt;/span&gt;    
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api-dev!&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# api-st.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;st.eomdev.com&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;stUser&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;stPassword&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtual-host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vhost02&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;9999&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api ST!&lt;/span&gt;


&lt;span class=&quot;c1&quot;&gt;# api-prod.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;eomdev.com&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;user&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;password&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtual-host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vhost03&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api prod!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;또는 아래와 같이 하나의 api.yml을 생성해서 profile 별로 분리를 시켜줄 수도 있습니다&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev.eomdev.com&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;devUser&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;devPassword&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtual-host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vhost01&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;9998&lt;/span&gt;    
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api-dev!&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# api-st.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;st&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;st.eomdev.com&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;stUser&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;stPassword&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtual-host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vhost02&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;9999&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api ST!&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# api-prod.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prod&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;eomdev.com&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;user&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;password&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtual-host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vhost03&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api prod!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 해당 디렉토리를 초기화해주고 git remote repository로 push해 줍니다.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git init
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git add &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git commit &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;first commit&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git remote add origin &amp;lt;Remote Repository 주소&amp;gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git push &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; origin master
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;3-spring-config-server-생성&quot;&gt;3. Spring Config Server 생성&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;와 &lt;code class=&quot;highlighter-rouge&quot;&gt;Actuator&lt;/code&gt;를 추가해서 config-server 프로젝트를 새로 만들어 줍니다&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/53705652-62b49200-3e69-11e9-84bf-abbc042fd566.png&quot; alt=&quot;2019-03-04 10 35 10&quot; /&gt;&lt;/p&gt;

&lt;p&gt;아래와 같이 Application.java 에 &lt;code class=&quot;highlighter-rouge&quot;&gt;@EnableConfigServer&lt;/code&gt;를 추가해줍니다&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@SpringBootApplication&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableConfigServer&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;// 추가&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigServer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SpringApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConfigServer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;31-local-개발-환경-설정&quot;&gt;3.1 local 개발 환경 설정&lt;/h2&gt;

&lt;p&gt;local에서 개발시에는 자유롭게 properties 들을 추가, 수정, 삭제하면서 개발하기 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;remote git repository&lt;/code&gt;를 바라보는 것이 아니라, &lt;strong&gt;로컬에 존재하는 환경설정 파일을 바라보게 설정&lt;/strong&gt;해줘야 합니다.&lt;/p&gt;

&lt;p&gt;이렇게 하기 위해서는 &lt;code class=&quot;highlighter-rouge&quot;&gt;application.yml&lt;/code&gt;에 읽어 올 Config file 의 위치를 &lt;code class=&quot;highlighter-rouge&quot;&gt;spring.cloud.config.server.native.searchLocations&lt;/code&gt;의 값으로 설정해주고, local에 존재하는 해당 환경설정 파일을 읽어올 수 있도록 &lt;code class=&quot;highlighter-rouge&quot;&gt;native&lt;/code&gt; Profile을 활성화 해야 합니다.&lt;/p&gt;

&lt;p&gt;즉, 아래와 같이 설정해 줍니다.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;active&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;native&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# file system에서 Config file을 읽어 올 수 있도록 native profile을 활성화시켜야 합니다.&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;native&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cloud&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;native&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;search-locations&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;file://${user.home}/IdeaProjects/study/blog-samples/config-repo&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# config file의 위치. 윈도우의 경우에는 &quot;/&quot;가 추가로 필요합니다.(file:///${user.home}/...)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;8888&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 실제로 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;에게 http://localhost:8888/api/dev 를 호출해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;api-dev.yml&lt;/code&gt;의 환경설정 정보를 가져왔다는 것을 아래와 같이 확인할 수 있습니다.&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;api&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;profiles&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dev&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;label&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;state&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;propertySources&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file:///Users/eomdev/IdeaProjects/study/blog-samples/config-repo/api.yml (document #0)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.profiles&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dev&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dev.eomdev.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5672&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.username&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;devUser&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;devPassword&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.virtual-host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;vhost01&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;server.port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9998&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;custom.message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hello, api-dev!&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;Config Server에게 url을 요청해서 환경설정 정보를 가져오는 전략에 대해서는 아래 3.3 Config Server URL 설명에서 다루겠습니다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;32-remote-git-repository-설정&quot;&gt;3.2 Remote Git Repository 설정&lt;/h2&gt;

&lt;p&gt;dev, st, prod 에서는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Remote Git Repository(여기에서는 Github)&lt;/code&gt;를 바라보고 사용하도록 설정해주면 됩니다&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt; 애플리케이션의 &lt;code class=&quot;highlighter-rouge&quot;&gt;application.yml&lt;/code&gt;에 아래 내용을 추가해줍니다&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;active&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;native&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;8888&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;native&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cloud&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;native&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;search-locations&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;file://${user.home}/IdeaProjects/study/blog-samples/config-repo&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cloud&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;git&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;https://github.com/umsh86/blog-samples.git&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;search-paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;config-repo&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 저는 환경설정 파일들이 /blog-samples/config-repo 하위에 있어서 search-paths를 설정해주었습니다.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#          username: # private-repo라면 접근권한이 있는 username, password를 설정해주면 됩니다&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#          password: #&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 &lt;code class=&quot;highlighter-rouge&quot;&gt;spring.profiles.active=dev&lt;/code&gt;로 변경해서 실행하거나, 아래와 같이 옵션을 사용해서 애플리케이션을 실행합니다.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gradle bootRun &lt;span class=&quot;nt&quot;&gt;-Dspring&lt;/span&gt;.profiles.active&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;dev

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;java &lt;span class=&quot;nt&quot;&gt;-jar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Dspring&lt;/span&gt;.profiles.active&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;dev ./api.jar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 &lt;code class=&quot;highlighter-rouge&quot;&gt;Remote Git Repository&lt;/code&gt;에서 정상적으로 환경설정 파일을 가져왔는지 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;의  http://localhost:8888/api/dev 를 호출해서 확인해줍니다.&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;api&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;profiles&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dev&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;label&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;8a736c7b1e061366fb12ba38ecd6eb61ddeeeeae&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;state&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;propertySources&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;https://github.com/umsh86/blog-samples.git/config-repo/api.yml (document #0)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.profiles&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dev&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dev.eomdev.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5672&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.username&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;devUser&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;devPassword&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;spring.rabbitmq.virtual-host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;vhost01&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;server.port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9998&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;custom.message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hello, api-dev!&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;33-config-server-url-설명&quot;&gt;3.3 Config Server URL 설명&lt;/h2&gt;

&lt;p&gt;위에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;에서 url을 호출해서 환경설정 정보를 확인하기 위해  http://localhost:8888/api/dev 를 호출했는데, 이 부분은  http://localhost:8888/{application}/{profile}/{label} 형태 입니다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;{application}&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;에서 설정되어 있는 &lt;code class=&quot;highlighter-rouge&quot;&gt;spring.application.name&lt;/code&gt; 속성으로 지정된 애플리케이션의 이름을 의미합니다.  여기에서는  &lt;code class=&quot;highlighter-rouge&quot;&gt;spring.application.name=api&lt;/code&gt;으로 설정하여, &lt;code class=&quot;highlighter-rouge&quot;&gt;api.yml&lt;/code&gt;에 있는 정보들을 사용할 예정입니다.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;{profile}&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;에 설정되어 있는 &lt;code class=&quot;highlighter-rouge&quot;&gt;spring.profiles.active&lt;/code&gt; 의 값이고, comma(,)로 구분되어 있는 여러 개의 값일 경우 마지막 값이 적용 됩니다. 기본 profile 값은 default 입니다.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;{label}&lt;/code&gt; : 필수가 아닌 옵션이며, git branch의 이름을 나타냅니다. 기본 값은 master입니다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;이 {application}, {profile}, {lable}의 값을 가지고 아래와 같은 방법으로도 Config Server에게 환경설정 정보 값들을 확인 할 수 있습니다.&lt;/p&gt;

&lt;div class=&quot;language-http highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;/{application}/{profile}[/{label}]
/{application}-{profile}.yml
/{label}/{application}-{profile}.yml
/{application}-{profile}.properties
/{label}/{application}-{profile}.properties
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;4-config-client샘플-애플리케이션-생성&quot;&gt;4. Config Client(샘플 애플리케이션) 생성&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client(샘플 애플리케이션)&lt;/code&gt;을 만들고, 필요한 환경설정 정보들을 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;에 요청해서 가져오는 부분입니다.&lt;/p&gt;

&lt;p&gt;우선 Spring Initializr로 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Web&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Actuator&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;lombok&lt;/code&gt;를 선택해서 프로젝트를 생성해줍니다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/54654415-774b8800-4b01-11e9-822c-417f4142fc17.png&quot; alt=&quot;스크린샷 2019-03-20 오전 11 14 20&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;41-bootstrapyml-설정&quot;&gt;4.1 bootstrap.yml 설정&lt;/h2&gt;

&lt;p&gt;Spring Boot Application은 일반적으로 applicatin.yml 이나 application.properties를 사용합니다. 하지만 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;는 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootstrap.yml&lt;/code&gt; 파일을 사용하며, 여기에 설정된 내용은 &lt;code class=&quot;highlighter-rouge&quot;&gt;application.yml&lt;/code&gt;보다 먼저 로드됩니다.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;bootstrap.yml&lt;/code&gt;을 생성해주고 아래와 같이 설정해줍니다&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;active&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;application&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;api&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# /{application}/{profile}/{label}을 생각해서 애플리케이션 이름을 정해줍니다.&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;management&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;endpoints&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;base-path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/actuator&lt;/span&gt; 
      &lt;span class=&quot;na&quot;&gt;exposure&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;refresh'&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# actuator의 refresh를 사용할 수 있게 해줍니다. 뒤에서 설명합니다.&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cloud&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http://localhost:8888&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# config server의 uri를 설정해줘야합니다&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;st&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cloud&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http://stapi.eomdev.com&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prod&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cloud&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http://api.eomdev.com&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 실제로 설정된 환경설정 값을 확인하기 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;custom.message&lt;/code&gt;만 읽어서 확인할 수 있도록 아래의 2개 class를 생성해줍니다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Component&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@ConfigurationProperties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;custom&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@RefreshScope&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Getter&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Setter&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigProperties&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ConfigProperties&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;configProperties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;nd&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/config&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;configProperties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;@RefreshScope로 선언해주면 Actuator의 /refresh 호출을 통해서 해당 Bean의 값이 변경됩니다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;그리고 애플리케이션을 실행하면 아래와 같이 console log를 통해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;에서 환경설정 정보들을 가져왔다는 것을 확인할 수 있습니다.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# config server localhost:8888에서&lt;/span&gt;
2019-03-20 17:51:30.046  INFO 25096 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;           main] c.c.c.ConfigServicePropertySourceLocator : Fetching config from server at : http://localhost:8888

&lt;span class=&quot;c&quot;&gt;# 아래의 environment 정보로&lt;/span&gt;
2019-03-20 17:51:30.376  INFO 25096 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;           main] c.c.c.ConfigServicePropertySourceLocator : Located environment: &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;api, &lt;span class=&quot;nv&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=[&lt;/span&gt;dev], &lt;span class=&quot;nv&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;null, &lt;span class=&quot;nv&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;null, &lt;span class=&quot;nv&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;null

&lt;span class=&quot;c&quot;&gt;# 실제로 환경설정 정보 파일을 가져왔는지 확인할 수 있습니다.&lt;/span&gt;
2019-03-20 17:51:30.376  INFO 25096 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;           main] b.c.PropertySourceBootstrapConfiguration : Located property &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;: CompositePropertySource &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'configService'&lt;/span&gt;, &lt;span class=&quot;nv&quot;&gt;propertySources&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=[&lt;/span&gt;MapPropertySource &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'file:///Users/sheom/IdeaProjects/study/blog-samples/config-repo/api.yml (document #0)'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}]}&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;실제로 &lt;code class=&quot;highlighter-rouge&quot;&gt;/config&lt;/code&gt;로 요청해보면 &lt;code class=&quot;highlighter-rouge&quot;&gt;Hello, api-dev!&lt;/code&gt; 메시지가 정상적으로 나오는 것을 확인할 수 있습니다.&lt;/p&gt;

&lt;h1 id=&quot;5-테스트&quot;&gt;5. 테스트&lt;/h1&gt;

&lt;p&gt;실제로 값이 제대로 변경되는지 테스트를 하기 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Repo&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;api.yml&lt;/code&gt;에서 값을 변경해줍니다.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;profiles&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;rabbitmq&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev.eomdev.com&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;5672&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;devUser&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;devPassword&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtual-host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vhost01&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;9998&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Hello, api-dev! Test!!!&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# Test!!! 를 추가해주었습니다.&lt;/span&gt;
  
  &lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Client&lt;/code&gt;애플리케이션에게 변경된 정보를 가져오라고 알려주기 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;Actuator&lt;/code&gt;의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/refresh&lt;/code&gt;를 &lt;code class=&quot;highlighter-rouge&quot;&gt;POST&lt;/code&gt;로 호출해줘야 합니다.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl localhost:8080/actuator/refresh &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Content-Type: application/json&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;custom.message&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# custom.message가 바뀌었음을 알려줌&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 다시 한번 &lt;code class=&quot;highlighter-rouge&quot;&gt;/config&lt;/code&gt;를 호출하면 &lt;code class=&quot;highlighter-rouge&quot;&gt;Hello, api-dev! Test!!!&lt;/code&gt;로 변경된 값이 정상적으로 출력되는 것을 확인해볼 수 있습니다.&lt;/p&gt;

&lt;h1 id=&quot;6-정리&quot;&gt;6. 정리&lt;/h1&gt;

&lt;p&gt;이렇게 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;를 사용하면 애플리케이션을 재시작하지 않고도 환경설정 정보를 변경할 수 있습니다. 하지만, 변경된 내용을 적용하기 위해서는 각각의 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Client&lt;/code&gt;인스턴스에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;/refresh&lt;/code&gt;를 호출해줘야하는 불편한점이 있습니다.&lt;/p&gt;

&lt;p&gt;이 부분은&lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Cloud Bus&lt;/code&gt;를 사용하면, &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Repo&lt;/code&gt;에서 환경설정 정보가 변경되면  &lt;code class=&quot;highlighter-rouge&quot;&gt;Config-Client&lt;/code&gt;에게 변경되었다고 전파해서 자동으로 변경되도록 할 수 있다고 합니다.&lt;/p&gt;

&lt;p&gt;관련 내용은 다음에 정리해보도록 하겠습니다.&lt;/p&gt;
</description>
        <pubDate>Thu, 21 Mar 2019 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/springcloud/2019/03/21/Spring-Cloud-Config.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/springcloud/2019/03/21/Spring-Cloud-Config.html</guid>
        
        
        <category>SpringCloud</category>
        
      </item>
    
      <item>
        <title>Spring Cloud?</title>
        <description>&lt;p&gt;블로그에 Spring Cloud라는 카테고리를 새로 만들었습니다. 앞으로 Spring Cloud와 관련된 것들을 공부하고 글을 작성해보려고 합니다. Spring Cloud에 대해서 공부하고 블로그에 글을 남겨봐야겠다는 생각이 갑자기 든 이유는 아래와 같습니다.&lt;/p&gt;

&lt;p&gt;Dropbox에 있는 문서들을 정리하다가 현재 다니고 있는 회사에 지원했을 때 작성했던 이력서를 보게되었습니다. 2016년도 초반에 작성된 이력서 였는데, 아래와 같이 관심사, 앞으로 경험해 보고 싶은 것들에 대해 적어놓은 부분이 있었습니다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/53842654-7257e600-3fe3-11e9-8c47-fc7ff04fee1c.png&quot; alt=&quot;2019-03-06 7 42 42&quot; /&gt;&lt;/p&gt;

&lt;p&gt;2016년도에 이직을 준비하면서 이러한 관심사를 가지고 있는 사람들이 있는 회사로 이직을 했으면 좋겠고, 같은 관심사를 가지고 있는 개발자들과 함께 더 나은 서비스 개발을 위해 노력하고 경험해보고 싶은 마음에서 작성했던 것 같습니다.&lt;/p&gt;

&lt;p&gt;그리고 현재 2019년이 되어 작성했던 이력서들을 처음부터 자세히 읽어보니, 그 당시에 마음먹었던 것들, 특히 관심을 가지고 경험해보고자 했던것들을 정복(?)하지 못했다는 생각이 들었습니다.&lt;/p&gt;

&lt;p&gt;지금이라도 하나씩 정복(?)을 해보자는 생각이 들었고, 첫번째로 MSA에 대한 부분을 타겟으로 잡았습니다.&lt;/p&gt;

&lt;p&gt;저도 아직 실무에 사용해본적은 없어서 자세한 내용은 모르지만, 간단하게 Spring Cloud에 대해서 이야기를 하자면 아래와 같습니다.&lt;/p&gt;

&lt;p&gt;Spring Cloud는 &lt;a href=&quot;https://spring.io/projects/spring-cloud&quot;&gt;Spring Cloud Reference&lt;/a&gt; 에 설명되어 있는것 처럼  분산 시스템 개발에 필요한 공통적인 패턴들을 모아서 사용하기 쉬운 스프링 라이브러리 형태로 제공하는 것들입니다.&lt;/p&gt;

&lt;p&gt;예를 들면 환경설정 외부화와 관련이 있는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Config Server&lt;/code&gt;, Routing과 관련이 있는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Zuul&lt;/code&gt;이나 &lt;code class=&quot;highlighter-rouge&quot;&gt;Gateway&lt;/code&gt;, 서비스를 등록하고 탐색하는 Discovery 역할을 하는 &lt;code class=&quot;highlighter-rouge&quot;&gt;Eureka&lt;/code&gt; 등이 존재한다고 알고 있습니다.&lt;/p&gt;

&lt;p&gt;우선은 환경설정(일반적으로 Config, Properties, Yml들을 말합니다)과 관련된 정보들을 외부화된 환경설정 서버로 따로 두는 Spring Cloud Config Server와 이 Config Server를 사용하는 애플리케이션인 Config Client에 대해서 실습해보고 정리해보려고 합니다.&lt;/p&gt;

&lt;p&gt;관련 내용은 실습, 정리하는대로 다음 글에 작성해보겠습니다.&lt;/p&gt;
</description>
        <pubDate>Wed, 06 Mar 2019 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/springcloud/2019/03/06/Spring-Cloud.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/springcloud/2019/03/06/Spring-Cloud.html</guid>
        
        
        <category>SpringCloud</category>
        
      </item>
    
      <item>
        <title>DDD와 Setter, Default Constructor에 대해서</title>
        <description>&lt;p&gt;회사에서 진행하고 있는 프로젝트에 DDD(Domain-Driven Design)를 적용하고, 코드리뷰를 진행하면서 몇 분들이 궁금해했던 내용에 대해서 정리를 해두려고한다.&lt;/p&gt;

&lt;h1 id=&quot;1-jpa를-사용하는-domain-class에서-setter-메소드를-만들지-않아도-되는가&quot;&gt;1. JPA를 사용하는 Domain class에서 Setter 메소드를 만들지 않아도 되는가?&lt;/h1&gt;
&lt;p&gt;결론은 만들지 않아도 된다이다. JPA는 필드와 메서드 2가지 방식으로 매핑처리를 할 수 있다.
명시적으로 Domain에 @Access(AccessType.FIELD)을 써주지 않는다면 @Id나 @EmbbededId가 어디(필드 또는 get메소드)에 위치해 있느냐에 따라서 접근 방식을 결정한다. 
그래서 명시적으로 @Access(AccessType.FIELD)를 써주거나, 필드에 @Id 애노테이션만 붙어있으면 Setter 메소드는 필요하지 않는다.&lt;/p&gt;

&lt;h1 id=&quot;2-기본생성자가-protected로-하면-오류가-발생하지-않는가&quot;&gt;2. 기본생성자가 protected로 하면 오류가 발생하지 않는가?&lt;/h1&gt;
&lt;p&gt;기본생성자가 필요한 이유는 하이버네이트와 같은 JPA프로바이더는 DB에서 데이터를 읽어와 매핑된 객체를 생성할 때 기본생성자를 사용해서 객체를 생성하기 때문에 기본생성자는 꼭 추가해주어야 한다. 
하지만, 기본 생성자를 다른 코드에서 사용하면 값이 없는 온전하지 못한 객체를 만들게 되므로, 다른 코드에서 기본 생성자를 사용하지 못하도록 proteced로 해주었다.&lt;/p&gt;

&lt;p&gt;또 하이버네이트는 클래스를 상속한 프록시 객체를 이용해서 지연로딩을 구현하는데, 이 경우에 프록시 클래스에서 상위 클래스의 기본 생성자를 호출할 수 있어야 하므로 
지연 로딩 대상이되는 @Entity, @Embeddable의 기본생성자는 private이 아닌 proteced로 지정해주어야한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;출처 : DDD Start! - 도메인 주도 설계 구현과 핵심 개념 익히기 (지은이 최범균)&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        <pubDate>Sun, 17 Feb 2019 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/etc/2019/02/17/DDD1.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/etc/2019/02/17/DDD1.html</guid>
        
        
        <category>etc</category>
        
      </item>
    
      <item>
        <title>IntelliJ의 Http Client 사용하기</title>
        <description>&lt;p&gt;IntelliJ에서 제공하는 Http Client가 생각보다 편리해서 간단하게 사용하는 법만 정리해놓는다.
더 자세한 내용은 https://www.jetbrains.com/help/idea/http-client-in-product-code-editor.html 를 참고하면 될 것 같다.&lt;/p&gt;

&lt;h1 id=&quot;1-actuator-추가하기&quot;&gt;1. actuator 추가하기&lt;/h1&gt;
&lt;p&gt;IntelliJ 2018.1 버전부터 추가된 기능인데, Controller의 @RequestMapping 기반으로 http 테스트를 자동으로 실행해주는 기능이 있다.&lt;/p&gt;

&lt;p&gt;이 기능을 사용하기 위해서는 Spring Boot의 Actuator를 추가해주어야 한다.(Http Client 사용 자체는 Actuator를 추가하지 않아도 사용할 수 있다.)&lt;/p&gt;

&lt;p&gt;gradle 기반으로 프로젝트를 생성했기 때문에 아래와 같이 build.gradle에 추가해주었다.&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;compile('org.springframework.boot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;spring-boot-starter-actuator')&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 Spring Boot 애플리케이션을 실행시키고 Controller에 들어가면 아래와 같이 왼쪽에 Run icon들이 생긴 것을 볼 수 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/44409169-d57cb080-a59c-11e8-9965-eee0cad5e20b.png&quot; alt=&quot;image01&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;2-http-client-사용하기&quot;&gt;2. Http Client 사용하기&lt;/h1&gt;

&lt;p&gt;사용하는 방법은 간단하다. 위에 생긴 초록색 Run icon을 클릭하면, 위의 이미지와 같이 3가지를 사용할 수 있다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Run HTTP Request : 바로 실행이 되고, 결과는 아래와 같이 바로 볼 수 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/44409440-4fad3500-a59d-11e8-8278-31b16551ee1e.png&quot; alt=&quot;image02&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Open in HTTP Request Editor : 아래와 같이 HTTP Request Editor를 열어서 필요한 부분들을 추가, 수정하여 사용할 수 있다.
여기서는 새로운 Account를 저장하는 부분을 테스트하기 위해서 Content-Type하고, Request Body를 추가해서 실행하였고, 결과는 바로 아래에 보는 것과 같이 정상적으로 추가되었음을 알 수 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/44409864-26d96f80-a59e-11e8-8792-19538e85bd09.png&quot; alt=&quot;2018-08-21 11 58 18&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Open in Browser : 브라우저에서 바로 실행한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/44410582-b5022580-a59f-11e8-819d-38cacee8007a.png&quot; alt=&quot;image04&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;File &amp;gt; New &amp;gt; HTTP Request 파일을 선택해서 .http 파일을 생성해서 직접 작성해 줄 수도 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/51478186-138d3300-1dce-11e9-8122-714a2193d86e.png&quot; alt=&quot;2019-01-21 10 42 56&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;3-http-client에-environment-variables-사용하기&quot;&gt;3. Http Client에 environment variables 사용하기&lt;/h1&gt;
&lt;p&gt;local, dev, st 환경에서 번갈아가면서 테스트할 때 꽤나 유용했다. &lt;code class=&quot;highlighter-rouge&quot;&gt;http-client.env.json&lt;/code&gt; 파일을 생성하고, 아래와 같이 local, dev, st, production 등에서 사용할 정보들을 입력해준다&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;local&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;apiAddress&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://localhost&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;localUser01&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password01&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dev&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;apiAddress&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://dev.xxxxx.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;devUser01&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password01&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
    &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;	
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 Request Editor에서 아래와 같이 변경해주고 실행하게 되면, 사용할 environment를 선택할 수 있다. 
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/51479376-661c1e80-1dd1-11e9-8472-4c0fecbb3281.png&quot; alt=&quot;2019-01-21 11 07 15&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그리고 응답을 받은 데이터를 &lt;code class=&quot;highlighter-rouge&quot;&gt;.http&lt;/code&gt;의 변수에 저장하고, 다른 테스트에서 변수에 저장된 값을 사용할 수 있다. 예를 들면, 위의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/authorizationKey&lt;/code&gt; 요청을 통해서 아래와 같은 응답을 받는다고 가정해보자&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;returnCode&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;200&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;returnData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;authorizationKey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;    
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;이 응답에 존재하는 authorizationKey를 아래와 같이 변수에 저장할 수 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/51481424-2eb07080-1dd7-11e9-98e8-06a223bd3e58.png&quot; alt=&quot;2019-01-21 11 38 37&quot; /&gt;&lt;/p&gt;

&lt;p&gt;authorizationKey 변수를 사용해서 다른 요청을 하는 방법은 아래와 같다.
&lt;img width=&quot;320&quot; alt=&quot;2019-01-21 11 55 56&quot; src=&quot;https://user-images.githubusercontent.com/1261904/51481824-27d62d80-1dd8-11e9-98ef-a82d5ee5ce74.png&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;4-file-upload20190218-추가&quot;&gt;4. file upload(2019.02.18 추가)&lt;/h1&gt;

&lt;pre&gt;
### file upload
POST http://localhost:8080/upload
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.png&quot;

&amp;lt; /Users/eomdev/Desktop/test.png
--WebAppBoundary--
&lt;/pre&gt;
</description>
        <pubDate>Mon, 21 Jan 2019 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/intellij/2019/01/21/Intellij_http_client.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/intellij/2019/01/21/Intellij_http_client.html</guid>
        
        
        <category>intellij</category>
        
      </item>
    
      <item>
        <title>2019년을 맞이하며</title>
        <description>&lt;p&gt;2019년 새해가 밝은지는 시간이 조금 지났지만(오늘은 2019년 1월 13일..), 새해를 맞이하며 열심히 살아야겠다고 다짐하고 실행하고 있는 것들을 적어보려고 한다.&lt;/p&gt;

&lt;h1 id=&quot;첫번째로-회사-출퇴근시간에-관련된-내용이다&quot;&gt;첫번째로 회사 출퇴근시간에 관련된 내용이다.&lt;/h1&gt;
&lt;p&gt;2018년 12월 중순쯤부터 2018년도를 되돌아보니 내가 만족할만한 2018년도는 아니었다는 생각이 들었다.(솔직히 말하자면 나태했어.. 나태해도 너무 나태했지..)&lt;/p&gt;

&lt;p&gt;뭐 이런저런 이유로 2019년도에는 열심히 살아야겠다는 생각이 들었고, 첫번째로 출퇴근 시간을 변경해서 자기계발 시간을 가져야겠다는 생각이 들었다.&lt;/p&gt;

&lt;p&gt;회사의 공식적인 출퇴근 시간은 9시 출근 / 6시 퇴근이다. 하지만 8시간의 근무시간을 지킨다면 어느정도는 유연하게 출퇴근을 할 수가 있는데,
2019년도에는 이런저런 이유로 열심히 살아보기로 마음을 굳게 먹고, 첫번째로 8시 출근/ 5시 퇴근을 하기로 마음먹었다. 그래서 12월말부터 연습을 했고, 1월 10일까지 계속해서 진행하고 있다.&lt;/p&gt;

&lt;p&gt;8시 출근 / 5시 퇴근을 하면서 느낀 장점을 이야기해보자면, 우선 지하철에 확실히 사람이 덜 붐빈다는 점이다. 
집에서 회사까지는 지하철 2번 환승을 해야하고, 앉아서 가는 것이 거의 불가능에 가깝기 때문에 9시에 출근할 때는 거의 지옥철 상태로 1시간 이상을 서서가야 했었다.(출근을 하면 이미 지쳐있…) 
8시 출근을 시작해보니, 확실히 지하철에 사람이 덜 붐비고, 지하철 연착도 없기 때문에 출근시간이 10분~15분은 당겨졌다.&lt;/p&gt;

&lt;p&gt;또 5시에 퇴근해서, 집에와서 저녁먹고 집안일을 해도 저녁 8시가 넘지 않고 시간이 많이 남았다. 그래서 건강한 삶을 살아보고자 운동을 해서 헬스를 등록했고, 자기계발의 시간도 가지고 있다.&lt;/p&gt;

&lt;p&gt;하지만 단점이라면.. 5시에 퇴근이 불가능할 때가 종종 있다는 점이다(아하하하하하하)&lt;/p&gt;

&lt;p&gt;어쨌든 8시 출근 / 5시 퇴근에 대해서 아주 대만족을 하고 있었다. 1월 10일(목)까지는 말이다.&lt;/p&gt;

&lt;h1 id=&quot;1월-10일목-이후-달라진점&quot;&gt;1월 10일(목) 이후 달라진점&lt;/h1&gt;

&lt;p&gt;1월 10일(목)에 열심히 살아야겠다고 생각을 더 자극하는 일들이 있었고, 무엇을 할 수 있을까 생각하다가 7시에 출근 해서 회사가 조용할 때 독서를 해보기로 마음먹었다(그렇다고 4시에 퇴근할 생각은 아니다).
우선 5시에 기상을 했고, 5시 40분쯤 집에서 나와서 지하철을 탔다.&lt;/p&gt;

&lt;p&gt;원래 예상했던 시나리오는 지하철에 앉아서 갈 수 있을거라 생각했고, 출근하면서 독서를 시도해보는 것이었는데, 오히려 8시 출근할 때보다 사람들이 더 많았고, 출근길에 지하철에 앉아서 가면서 독서한다는 것은 앞으로도 포기해야할 듯 싶었다.&lt;/p&gt;

&lt;p&gt;회사 앞 지하철역(몽촌토성)에 도착했을 때 시간은 6시 40분정도 되었고, 여전히 어두컴컴했다.(초점은 왜이리 흔들렸는가..)
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/51074814-0635c180-16c7-11e9-9db3-abf4fd00953b.JPG&quot; alt=&quot;img_0484&quot; /&gt;&lt;/p&gt;

&lt;p&gt;회사에 도착해서 내 자리에만 불을 켰고, 조용히 독서를 할 수 있었다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/51074789-9aebef80-16c6-11e9-86f7-1a3a5b1e8a38.JPG&quot; alt=&quot;img_2055&quot; /&gt;&lt;/p&gt;

&lt;p&gt;독서를 하면서 방해 요소가 한가지 있었는데, 어디선가 울리는 아이폰의 알람소리였다. 어디선가 테스트폰의 알람소리가 울리는 것이라고 생각했으나 결국 찾지 못했었고, 모두가 출근하고 나서야 의심이되는 자리 주위 사람들에게 물어봐서 찾을 수 있었다.&lt;/p&gt;

&lt;p&gt;7시 출근은 아직 하루 밖에 안했지만, 앞으로도 꾸준히 할 수 있을거라는 생각이 들었다. 다만 모든 약속은 가능하면 금요일이나 주말로 해야겠다는 생각은 들었다. 그렇지 않으면 5시에 일어나기가 힘들 것 같다.&lt;/p&gt;

&lt;p&gt;나중에 2019년도를 돌아볼 때, 이 기록을 보고 회고할 수 있는 시간이 되기를 빌면서, 또 나태해질 때 이 글을 보면서 마음을 다시 잡자는 의미에서 2019년 첫 글은 다짐, 각오로 정리해보았다.&lt;/p&gt;
</description>
        <pubDate>Sat, 12 Jan 2019 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/etc/2019/01/12/VolumeUp.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/etc/2019/01/12/VolumeUp.html</guid>
        
        
        <category>etc</category>
        
      </item>
    
      <item>
        <title>OSX에 Docker로 Jenkins 설치하기</title>
        <description>&lt;p&gt;오랜만에 블로그에 글을 쓰게 되었다.&lt;/p&gt;

&lt;p&gt;원래는 일을 하거나 공부하면서 생겼던 것들을 나중에 까먹지 않기 위해서 기록하는 용도로 주기적으로 글을 쓰려고 했었다.
하지만 공개적으로 노출이 되는 것이라서 나만 알아볼 수 있게 대충 적어놨던 것들을 다시 잘 정리해서 쉽게 풀어쓰는 작업이 필요했다.
이 부분을 하는데 아무래도 시간도 걸리고 게을러서 거의 2년간 새로운 글을 쓴 적이 없다.&lt;/p&gt;

&lt;p&gt;게다가 Dropbox와 같은 것들과 연동해서 사용할 수 있는 마크다운 앱을 구매하고 사용하면서 해당 앱에만 정리하기 시작한 것도 블로그에 글을 쓰지 않게 된 것에 상당히 크게 한 몫 했다.&lt;/p&gt;

&lt;p&gt;그러던 도중에 원래 주기적으로 토즈에서 가지던 지인들과의 소규모 모임이 있는데, 최근에는 각자의 바쁜 사정들로 인해서 진행되지 않았었다.
그 중 우리의 모임을 주도해서 이끌어나가고 있던 Jo님과의 만남에서 다시 슬슬 진행해보는게 어떻겠냐는 이야기가 나왔고, 다음 모임에서 내가 Jenkins에 대해서 발표를 해줬으면 좋겠다고 이야기를 하셨다.
나도 흔쾌히 승낙하였고, Jenkins에 대해서 무엇을 발표할까 생각하다가 Docker에 대한 소개도 간단히 할겸, Docker로 Jenkins를 설치하고, 어떻게 사용하는지에 대해서 발표를 해야겠다는 생각을 했다.
그리고 함께 실습을 하면서 진행사항이 조금 늦거나 지나간 내용을 다시 확인하고 싶은 분들을 위해서 자료를 공유해서 각자 볼 수도 있게 해야겠다는 생각이 들었다.
그래서 자료 공유하는 방법에 대해서 생각하다가 그냥 블로그에 글을 써서 같이 봐야겠다는 생각이 들었고, 덕분에 이렇게 오랜만에 글을 쓰게 되었다.&lt;/p&gt;

&lt;h1 id=&quot;1-목표&quot;&gt;1. 목표&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;Docker를 통해서 Jenkins 설치&lt;/li&gt;
  &lt;li&gt;GitHub에 있는 프로젝트와 연동해서 Push가 일어날 때, 자동으로 빌드되게 하기&lt;/li&gt;
  &lt;li&gt;작업이 완료되면 Slack을 통해서 알림받기&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;2-jenkins&quot;&gt;2. Jenkins&lt;/h1&gt;

&lt;h2 id=&quot;21-jenkins-무엇&quot;&gt;2.1. Jenkins 무엇?&lt;/h2&gt;

&lt;p&gt;https://ko.wikipedia.org/wiki/젠킨스&lt;/p&gt;

&lt;h2 id=&quot;22-실제로-회사에서는-어떻게-사용하고-있는가&quot;&gt;2.2. 실제로 회사에서는 어떻게 사용하고 있는가?&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;개발자들이 일일 commit한 내용을 하루에 1번(예를 들면 오전 7시) 자동으로 build, deploy를 통해서 개발(Dev)서버에 반영되고 있다.&lt;/li&gt;
  &lt;li&gt;프로젝트의 개발 내용이 모두 끝나면(예를 들어 1.0.0 -&amp;gt; 1.0.1 업데이트 기능 모두 개발 완료) QA팀의 품질 테스트를 위해서 Staging서버에 build, deploy를 한다.&lt;/li&gt;
  &lt;li&gt;QA가 모두 종료되고, 실제 운영서버에 업데이트 하는 경우 Jenkins를 통해서 deploy를 하고 있다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;3-docker&quot;&gt;3. Docker&lt;/h1&gt;

&lt;h2 id=&quot;31-docker-무엇&quot;&gt;3.1. Docker 무엇?&lt;/h2&gt;
&lt;p&gt;Docker는 애플리케이션을 신속하게 구축, 테스트 및 배포할 수 있는 소프트웨어 플랫폼이며, 쉽게 말하면 VMware, Virtual PC와 같은 가상머신이다. 
그러나 OS를 설치하지 않고, OS자원은 호스트와 공유해서 사용하며, 서버 운영에 필요한 프로그램과 라이브러리만 격리해서 설치할 수 있는 장점이 있다. 
정리해서 말하자면 가상화머신보다 훨씬 빠르고, 호스트와 거의 동일한 속도로 사용할 수 있다!&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;도커에 대해 더 자세히 알아보고 싶다면 &lt;a href=&quot;http://pyrasis.com/docker.html&quot;&gt;가장 빨리 만나는 Docker&lt;/a&gt;를 추천한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;32-mac에서-docker-설치하기&quot;&gt;3.2. Mac에서 Docker 설치하기&lt;/h2&gt;

&lt;p&gt;https://www.docker.com/get-docker 에 접속해서 DOCKER COMMUNITY EDITION (무료)을 다운로드 해서 설치한다.&lt;/p&gt;

&lt;p&gt;설치 완료 및 실행이 정상적으로 되면 아래와 같은 화면을 볼 수 있다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872219-cbfafbfe-303d-11e8-9575-d38a1eff9097.png&quot; alt=&quot;2018-03-21 10 45 19&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;33-정상적으로-설치되었는지-확인&quot;&gt;3.3. 정상적으로 설치되었는지 확인&lt;/h2&gt;

&lt;p&gt;터미널에서 아래와 같은 명령어를 통해서 Docker가 정상적으로 설치되었는지 확인한다.&lt;/p&gt;

&lt;p&gt;Docker가 설치된 버전 확인&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ docker version 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;hello-world 실행. 아래와 같은 메시지가 출력된다면 정상이다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ docker run hello-world  
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
1. The Docker client contacted the Docker daemon.
2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
  (amd64)
3. The Docker daemon created a new container from that image which runs the
  executable that produces the output you are currently reading.
4. The Docker daemon streamed that output to the Docker client, which sent it
  to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
$ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
https://cloud.docker.com/

For more examples and ideas, visit:
https://docs.docker.com/engine/userguide/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;4-docker를-통해서-jenkins-설치하기&quot;&gt;4. Docker를 통해서 Jenkins 설치하기&lt;/h1&gt;

&lt;p&gt;터미널에서 Docker 명령어를 통해서 설치도 가능하지만, Kitematic(Docker 컨테이너들을 관리하는 그래픽 인터페이스)을 통해서 설치 및 실행 해보자.
우측 상단에서 도커 아이콘을 선택하여 Kitematic을 선택한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872297-abcddba6-303f-11e8-9e87-bb49ba1d1268.png&quot; alt=&quot;kitematic select&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Kitematic이 설치가 안되어 있다면 아래와 같은 화면이 나올 것이다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872322-4844bc16-3040-11e8-9978-e8c9571174c0.png&quot; alt=&quot;2018-03-21 11 07 28&quot; /&gt;&lt;/p&gt;

&lt;p&gt;설치를 하고, &lt;code class=&quot;highlighter-rouge&quot;&gt;/Applications&lt;/code&gt;에 옮긴다면 아래와 같은 화면이 뜬다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872325-4bd332c2-3040-11e8-90c8-bfc3d070d0ef.png&quot; alt=&quot;2018-03-21 11 14 09&quot; /&gt;&lt;/p&gt;

&lt;p&gt;회원가입을 하고 로그인을 하면 아래와 같이 Docker image 저장소인 Docker Hub에서 Docker image를 검색할 수 있는 화면이 나온다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872326-4bfabafe-3040-11e8-9db3-c175764a4497.png&quot; alt=&quot;2018-03-21 11 15 23&quot; /&gt;&lt;/p&gt;

&lt;p&gt;jenkins가 공식적으로 제공해주는 Docker 이미지 검색하고, Create 버튼을 눌러서 이미지 pull 받고 실행한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872384-9adfff16-3041-11e8-9d43-558da438bb03.png&quot; alt=&quot;2018-03-21 11 20 07&quot; /&gt;&lt;/p&gt;

&lt;p&gt;정상적으로 진행이 완료되면 아래와 같은 화면을 볼 수 있고, WEB PREVIEW 아래의 화면을 누르거나 http://localhost:32769 로 접속한다&lt;br /&gt;
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872328-4c46581a-3040-11e8-8d8e-552950c42a71.png&quot; alt=&quot;2018-03-21 11 25 08&quot; /&gt;&lt;/p&gt;

&lt;p&gt;설치를 진행하려면 아래와 같이 Jenkins의 administrator 패스워드를 입력해야 한다. 해당 패스워드는 Jenkins 컨테이너 내부의 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/jenkins_home/secrets/initialAdminPassword&lt;/code&gt;에 존재한다.
외부에서 컨테이너 내부의 파일을 읽기 위해서 먼저 컨테이너의 ID 또는 NAME을 확인해야 한다. 확인 방법은 아래와 같이 2가지 방법이 있다.&lt;/p&gt;

&lt;p&gt;먼저 Kitematic에서 확인하는 방법이다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872471-9542345a-3043-11e8-85e6-7ada0b97b91a.png&quot; alt=&quot;2018-03-21 11 52 54&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그리고 터미널에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;docker ps&lt;/code&gt; 명령어를 통해서 확인하는 방법이다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872472-956d3efc-3043-11e8-9643-76c297648fdb.png&quot; alt=&quot;2018-03-21 11 57 44&quot; /&gt;&lt;/p&gt;

&lt;p&gt;실행중인 Jenkins 컨테이너의 ID 또는 NAME을 확인한 뒤에 아래의 shell 명령어를 통해서 컨테이너 내부의 패스워드 파일을 읽을 수 있다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# 외부에서 컨테이너 내부의 명령을 실행하는 exec 명령. 컨테이너 안의 /bin/bash를 실행시킨다.
$ docker exec -i -t jenkins /bin/bash

# 컨테이너 내부의 패스워드 파일을 읽는다.
$ cat /var/jenkins_home/secrets/initialAdminPassword
c977cc7aa46e4d8fa8d2bd64043f4fde
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그러면 설치 방법 2가지 중에서 하나를 선택할 수 있다. 
install suggested plugins은 많이 사용되는 플러그인들이 자동으로 설치되는 것이고, select plugins to install은 필요한 플러그인들만 선택해서 설치가 가능하다.
나는 install suggested plugins로 설치를 진행했다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872512-67fb34a0-3044-11e8-82c6-105edbe2b70b.png&quot; alt=&quot;2018-03-22 12 08 30&quot; /&gt;&lt;/p&gt;

&lt;p&gt;설치 완료 후 관리자 계정 정보를 생성하면 아래와 같이 정상적으로 접속이 된다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37872532-bd8d87b0-3044-11e8-971c-5c8f9dd4cfb2.png&quot; alt=&quot;2018-03-22 12 19 14&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;5-jenkins-job-생성-및-github-연동하기&quot;&gt;5. Jenkins Job 생성 및 Github 연동하기&lt;/h1&gt;

&lt;h2 id=&quot;51-jenkins-job-생성하기&quot;&gt;5.1. Jenkins Job 생성하기&lt;/h2&gt;

&lt;p&gt;오른쪽위에 새로운 Item을 선택한다. 
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37876225-5efc040c-3084-11e8-97fa-7ad4ab66de63.png&quot; alt=&quot;2018-03-22 12 19 14&quot; /&gt;&lt;/p&gt;

&lt;p&gt;item name을 입력하고 Freestyle Project를 선택해서 새로운 Job을 생성해준다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37906834-43e438e6-313e-11e8-9d55-7be91c117e4e.png&quot; alt=&quot;2018-03-26 9 38 27&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Jenkins로 작업할 프로젝트 하나가 필요한데, Spring Boot 2.0 기반으로 Swagger를 적용한 프로젝트를 하나 만들었다. 
https://github.com/umsh86/demo 에 접속해서 아래와 같이 Repository URL을 Copy 한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37907280-94ac5708-313f-11e8-9055-26d14e024a73.png&quot; alt=&quot;2018-03-26 9 48 50&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Jenkins에서 소스관리 &amp;gt; Git &amp;gt; Repository URL에 복사한 URL을 넣고, Add 버튼을 클릭한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37907506-45553476-3140-11e8-8053-5d2134cc1da3.png&quot; alt=&quot;2018-03-26 9 53 12&quot; /&gt;&lt;/p&gt;

&lt;p&gt;자격 증명을 하는 방법에는 여러가지가 있는데, 여기서는 Github 계정과 패스워드를 사용했다.&lt;br /&gt;
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37876551-fc2ae71c-3088-11e8-9f1d-1b1a2acd2a9d.png&quot; alt=&quot;2018-03-26 12 01 25&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Credentials에 입력한 계정정보가 확인되고, 그 아래에 branch는 기본 &lt;code class=&quot;highlighter-rouge&quot;&gt;*/master&lt;/code&gt;로 되어있다. master branch에 push가 되면 Jenkins가 자동으로 build가 될 것이다. 만약 Git Flow를 사용하고 있고 develop branch에 push 될 때 build가 되기를 원한다면 branch에 &lt;code class=&quot;highlighter-rouge&quot;&gt;*/develop&lt;/code&gt;으로 변경해주면 된다. 
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37876582-71a5b4cc-3089-11e8-9e6e-6ddfadfa8059.png&quot; alt=&quot;2018-03-26 12 04 59&quot; /&gt;&lt;/p&gt;

&lt;p&gt;빌드 유발은 Github의 master branch가 push 될 때 해야되므로, &lt;code class=&quot;highlighter-rouge&quot;&gt;Github hook trigger for GITScm polling&lt;/code&gt;을 선택한다.
만약 자동으로 특정 시간별로 빌드를 하고 싶다면, &lt;code class=&quot;highlighter-rouge&quot;&gt;Build periodically&lt;/code&gt;을 선택해서 cron expression을 사용해서 등록해주면 된다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37876787-ab1ff0ca-308c-11e8-99b1-39bfd7c61b26.png&quot; alt=&quot;2018-03-26 12 27 06&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그리고 Github의 develop 브랜치에 push 되었을 때 실행할 빌드 명령어를 입력해주기 위해서, Build &amp;gt; Add Build Step &amp;gt; Execute shell 을 선택한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37907769-00f35730-3141-11e8-87f9-c0e89e4a8f06.png&quot; alt=&quot;2018-03-26 9 58 38&quot; /&gt;&lt;/p&gt;

&lt;p&gt;프로젝트에 별도의 그레이들 설치나 환경 설정 없이도 그레이들을 사용할 수 있도록 해주는 gradlew(윈도우는 gradlew.bat)이 있으므로,
아래와 같이 실행할 gradle 명령어를 작성하고 저장한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37911206-5e932fc4-314a-11e8-869f-fbc84e00178b.png&quot; alt=&quot;2018-03-26 11 06 12&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그러면 아래와 같이 프로젝트가 생성된 것을 볼 수 있다. 여기서 프로젝트의 이름을 선택해서
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37913183-411b8590-314f-11e8-8b01-c2519c60efe9.png&quot; alt=&quot;2018-03-26 11 37 26&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Build를 할 수 있고, Build History에 진행중인 작업 내용을 확인할 수 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37913184-41471d18-314f-11e8-8dfe-80859a487868.png&quot; alt=&quot;2018-03-26 11 37 57&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;52-github-연동하기&quot;&gt;5.2. Github 연동하기&lt;/h2&gt;

&lt;p&gt;위에서 설정했던 Github 저장소의 develop branch에 push가 일어났을 때, 자동으로 build가 되도록 설정하는 방법이다.
해당 프로젝트의 오른쪽 위의 Settings &amp;gt; Integration &amp;amp; Service &amp;gt; Add service &amp;gt; Jenkins(GitHub plugin) 을 선택한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37916139-141094e4-3156-11e8-99c4-4c505bcd19ef.png&quot; alt=&quot;2018-03-27 12 29 20&quot; /&gt;&lt;/p&gt;

&lt;p&gt;아래의 Jenkins hook url에 외부에서 접근할 수 있는 url을 입력해주면 된다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37945141-b33c559a-31b9-11e8-93f9-5a191169afa5.png&quot; alt=&quot;2018-03-27 12 23 22&quot; /&gt;&lt;/p&gt;

&lt;p&gt;현재 로컬 네트워크에서 작업중이기 때문에 외부에서 접근할 수 없으므로, &lt;code class=&quot;highlighter-rouge&quot;&gt;ngrok&lt;/code&gt;(https://ngrok.com)을 사용해서 로컬 네트워크를 외부에서 접속할 수 있게 설정해주면 된다.&lt;/p&gt;

&lt;p&gt;https://ngrok.com 에 접속해서 위에 Download를 선택하여, ngrok을 다운로드 받는다.
압축을 해제하고 자신의 PATH(예를 들면 /usr/local/bin)으로 옮긴 후 터미널을 통해서 아래와 같이 ngrok을 입력하면 사용법에 대해서 나온다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ngrok                                                                                                                             ✓  592  12:16:13
NAME:
   ngrok - tunnel local ports to public URLs and inspect traffic

DESCRIPTION:
    ngrok exposes local networked services behinds NATs and firewalls to the
    public internet over a secure tunnel. Share local websites, build/test
    webhook consumers and self-host personal services.
    Detailed help for each command is available with 'ngrok help &amp;lt;command&amp;gt;'.
    Open http://localhost:4040 for ngrok's web interface to inspect traffic.

EXAMPLES:
    ngrok http 80                    # secure public URL for port 80 web server
    ngrok http -subdomain=baz 8080   # port 8080 available at baz.ngrok.io
    ngrok http foo.dev:80            # tunnel to host:port instead of localhost
    ngrok tcp 22                     # tunnel arbitrary TCP traffic to port 22
    ngrok tls -hostname=foo.com 443  # TLS traffic for foo.com to port 443
    ngrok start foo bar baz          # start tunnels from the configuration file

VERSION:
   2.2.8

AUTHOR:
  inconshreveable - &amp;lt;alan@ngrok.com&amp;gt;

COMMANDS:
   authtoken	save authtoken to configuration file
   credits	prints author and licensing information
   http		start an HTTP tunnel
   start	start tunnels by name from the configuration file
   tcp		start a TCP tunnel
   tls		start a TLS tunnel
   update	update ngrok to the latest version
   version	print the version string
   help		Shows a list of commands or help for one command
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;아래와 같이 외부에서 접근 가능하도록 포트 번호를 입력해주면 된다&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ngrok http 32679
ngrok by @inconshreveable                                                                                                                   (Ctrl+C to quit)

Session Status                online
Session Expires               7 hours, 58 minutes
Version                       2.2.8
Region                        United States (us)
Web Interface                 http://127.0.0.1:4040
Forwarding                    http://c703aac0.ngrok.io -&amp;gt; localhost:32797
Forwarding                    https://c703aac0.ngrok.io -&amp;gt; localhost:32797

Connections                   ttl     opn     rt1     rt5     p50     p90
                              6       0       0.02    0.02    8.09    9.09

HTTP Requests
-------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그러면 외부에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;http://c703aac0.ngrok.io&lt;/code&gt;라는 주소로 접근이 가능해진다.
이 주소를 뒤에 &lt;code class=&quot;highlighter-rouge&quot;&gt;/github-webhook/&lt;/code&gt;을 붙여서 &lt;code class=&quot;highlighter-rouge&quot;&gt;http://c703aac0.ngrok.io/github-webhook/&lt;/code&gt;을 위에서 이야기했던 Jenkins hook url에 입력하고 Add Service를 선택해서 완료한다.&lt;/p&gt;

&lt;p&gt;그리고 실제로 develop branch에 push가 일어났을 때를 정상적으로 동작하는지를 테스트하기 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;README.md&lt;/code&gt; 파일을 생성했고, push를 하였다.
그러면 아래와 같이 Jenkins Job이 실행되는 것을 볼 수 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37945502-8b096246-31bb-11e8-92c7-0c2870c6c051.png&quot; alt=&quot;2018-03-27 12 34 36&quot; /&gt;&lt;/p&gt;

&lt;p&gt;위에서 Item(Job)이름을 클릭해서 들어가면 GitHub push에 의해서 작업이 시작되었다는 것을 알 수 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37945504-8b381280-31bb-11e8-80f0-867878b5b4e1.png&quot; alt=&quot;2018-03-27 12 35 17&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;6-slack에-jenkins-build-메시지-받도록-설정하기&quot;&gt;6. Slack에 Jenkins Build 메시지 받도록 설정하기&lt;/h1&gt;

&lt;p&gt;먼저 slack에서 왼쪽 위의 Channel 옆에 + 버튼을 눌러서 새로운 채널을 생성한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37945878-62dda802-31bd-11e8-8c6f-d953c2524b5a.png&quot; alt=&quot;2018-03-27 12 44 14&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Jenkins Build 메시지를 받을 채널 이름을 입력한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37945929-b72b987e-31bd-11e8-87ed-7fd8953afb7f.png&quot; alt=&quot;2018-03-27 12 44 22&quot; /&gt;&lt;/p&gt;

&lt;p&gt;새로운 채널이 생성되고 나면 왼쪽 아래에 &lt;code class=&quot;highlighter-rouge&quot;&gt;Apps&lt;/code&gt; 옆에 + 를 클릭한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37946030-2a27bef2-31be-11e8-8372-9af5f7836b40.png&quot; alt=&quot;2018-03-27 12 54 26&quot; /&gt;&lt;/p&gt;

&lt;p&gt;아래와 같이 Jenkins를 검색해서 Jenkins CI 브라우저 앱을 설치한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37967915-b54f05a0-3207-11e8-8fad-e083d710414d.png&quot; alt=&quot;2018-03-27 12 45 12&quot; /&gt;&lt;/p&gt;

&lt;p&gt;아래에서 Install을 클릭하고
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37969088-e7c8eaa2-320a-11e8-9ba3-bd06a05a2e67.png&quot; alt=&quot;2018-03-27 12 45 38&quot; /&gt;&lt;/p&gt;

&lt;p&gt;앞에서 생성한 Jenkins Build Message를 받을 채널을 선택해준다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/37969366-7c817c0e-320b-11e8-83f5-34c401c92335.png&quot; alt=&quot;2018-03-27 12 46 30&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그러면 Jenkins에서 어떤 작업들을 추가로 해줘야하는지에 대해서 자세한 설명이 나오는데, 그대로 똑같이 진행해주면 된다.
Step을 간단하게 정리하면, Jenkins 관리 &amp;gt; 플러그인 관리 &amp;gt; 설치 가능에서 Slack Notification Plugin 검색 및 설치한다.
그리고 나서 Jenkins 관리 &amp;gt; 시스템설정 &amp;gt; Global Slack Notifier Settings를 찾아서 Base URL과 Integration Token 정보를 입력해주면 된다.&lt;/p&gt;

&lt;p&gt;마지막으로 프로젝트의 구성 &amp;gt; 빌드 후 조치 추가 &amp;gt; Slack Notification을 선택한다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/38006862-c6271e42-3281-11e8-8073-f7a0005c1823.png&quot; alt=&quot;2018-03-27 11 34 38&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그리고 Slack으로 Noti를 종류를 선택해주면 되는데, Success 와 Fail에 대해서만 받기로 선택하였다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/38006916-fd94a53e-3281-11e8-940e-0eb13689ed3f.png&quot; alt=&quot;2018-03-27 11 35 20&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그리고 테스트를 위해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;README.md&lt;/code&gt; 파일을 수정했고, develop branch에 push를 진행하였다.
Jenkins가 다시 &lt;code class=&quot;highlighter-rouge&quot;&gt;./gradlew build&lt;/code&gt;가 실행되는 것을 볼 수 있고, Slack의 Jenkins 채널에도 메시지가 출력되는 것을 볼 수 있다.
&lt;img src=&quot;https://user-images.githubusercontent.com/1261904/38007099-b5b66134-3282-11e8-88a9-118c3bc85ffd.png&quot; alt=&quot;2018-03-28 12 22 22&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;정리&quot;&gt;정리&lt;/h1&gt;

&lt;p&gt;이렇게 해서 Docker를 가지고 Jenkins를 설치하고, GitHub 프로젝트와 연동해서 PUSH가 일어나면 자동으로 빌드가 진행되고, Slack을 통해서 작업 완료/실패에 대한 알림을 받는 부분까지 완료하였다.&lt;/p&gt;

&lt;p&gt;이번주 주말에 진행될 모임에서 이 자료를 가지고 좋은 시간을 보내길 기대해본다.&lt;/p&gt;

</description>
        <pubDate>Wed, 28 Mar 2018 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/tool/2018/03/28/Jenkins_with_Docker.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/tool/2018/03/28/Jenkins_with_Docker.html</guid>
        
        
        <category>tool</category>
        
      </item>
    
      <item>
        <title>파이썬 설치하기</title>
        <description>&lt;p&gt;OSX에 파이썬과 장고를 설치하고, 가상 환경(virtualenv) 설정, Intellij에 Python Plugin 설치 및 Hello World! 만들기&lt;/p&gt;

&lt;h1 id=&quot;1-파이썬-설치하기&quot;&gt;1. 파이썬 설치하기&lt;/h1&gt;

&lt;p&gt;기본적으로 OSX에는 파이썬이 설치되어 있다. 아래의 명령어로 python의 버젼을 확인할 수 있다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ python -V
Python 2.7.10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.x 버젼을 사용하려면 그대로 사용해도 되지만, python3를 설치하고 싶다면&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.python.org/downloads/&quot;&gt;https://www.python.org/downloads/&lt;/a&gt;에서 python3를 다운받아 설치해 주면 된다.
설치가 완료되었다면 아래 명령어로 python3가 설치된 것을 확인할 수 있다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ python3 -V
Python 3.5.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;2-가상-환경virtualenv-설정하기&quot;&gt;2. 가상 환경(virtualenv) 설정하기&lt;/h1&gt;

&lt;p&gt;파이썬의 가상 환경을 만들어서 프로젝트들 간의 독립성을 유지시켜주는 툴이다. 예를 들면 신규 프로젝트 A는 파이썬 3.x 버젼을 사용하고, 기존 프로젝트 B도 동시에 유지보수 하기 위해서 파이썬 2.x 버젼을 사용해야하는 상황을 해결해준다.&lt;/p&gt;

&lt;h2 id=&quot;virtualenv-생성하기&quot;&gt;virtualenv 생성하기&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ mkdir virtualEnv
$ cd virtualEnv
$ python3 -m venv myvenv  // myvenv 대신에 가상 환경 이름을 임의로 지정해 주면 된다 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;virtualenv-실행하기&quot;&gt;virtualenv 실행하기&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ source myvenv/bin/activate
(myvenv) $ python -V            // (myvenv) 가 앞에 새로 생겼다. 가상 환경으로 실행되고 있다는 뜻이고, 여기에서 파이썬 버젼을 확인해보면, 2.x가 아니라 3.x로 변경된 것을 볼 수 있다.
Python 3.5.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;3-장고-설치하기&quot;&gt;3. 장고 설치하기&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pip install django&lt;/code&gt; 명령어를 통해서 장고를 설치한다. &lt;code class=&quot;highlighter-rouge&quot;&gt;pip install django==1.8&lt;/code&gt;처럼 버젼을 명시해줄 수도 있다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(myvenv) $ pip install django==1.8
Collecting django==1.8
  Downloading Django-1.8-py2.py3-none-any.whl (6.2MB)
    100% |████████████████████████████████| 6.2MB 85kB/s
Installing collected packages: django
Successfully installed django-1.8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;혹시나 버젼을 업그레이드 하고 싶다면,&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ pip install --upgrade django
Collecting django
  Downloading Django-1.9.7-py2.py3-none-any.whl (6.6MB)
    100% |████████████████████████████████| 6.6MB 195kB/s
Installing collected packages: django
  Found existing installation: Django 1.8
    Uninstalling Django-1.8:
      Successfully uninstalled Django-1.8
Successfully installed django-1.9.7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;4-intellij-python-plugin-설치&quot;&gt;4. Intellij Python plugin 설치&lt;/h1&gt;

&lt;p&gt;보통은 PyCharm을 사용하지만, 기존에 IntelliJ를 쓰고 있었기에 추가로 구매하기는 좀 그래서 방법을 찾아보니 Intellij에서 Python Plugin을 설치해서 사용할 수 있다는 사실을 깨달음!&lt;/p&gt;

&lt;p&gt;바로 아래의 요놈을 설치해주면,
&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1261904/16516698/5a49c48e-3fb4-11e6-9be1-04242b8a32cb.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;새로운 모듈을 만들 때 Python이 추가된 것을 볼 수 있다.
&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1261904/16538798/dacc6476-4069-11e6-9ee4-5f5c92ac5aa9.png&quot; alt=&quot;2016-07-02 3 13 24&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그리고 오른쪽 위의 New -&amp;gt; Add Local을 선택해서 위에서 만들었던 VirtualEnv를 추가해준다.
&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1261904/16538808/1eac7366-406a-11e6-965c-16f63b009bb1.png&quot; alt=&quot;2016-07-02 3 12 01&quot; /&gt;&lt;/p&gt;

&lt;p&gt;그리고 새로운 모듈에 helloWorld.py 를 생성해주고, &lt;code class=&quot;highlighter-rouge&quot;&gt;print(&quot;Hello World!&quot;)&lt;/code&gt;를 작성하고 실행시켜서 정상적으로 “Hello World!” 메시지가 출력되면 끝!
&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1261904/16538840/fe3f750a-406a-11e6-8fed-d878451adb47.png&quot; alt=&quot;2016-07-02 3 38 00&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Fri, 01 Jul 2016 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/python/2016/07/01/install.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/python/2016/07/01/install.html</guid>
        
        
        <category>python</category>
        
      </item>
    
      <item>
        <title>MSA의 API Gateway 패턴 개념 잡기</title>
        <description>&lt;p&gt;예전에 조대협님의 블로그에 실린 &lt;a href=&quot;http://bcho.tistory.com/948&quot;&gt;마이크로 서비스 아키텍처의 이해(MSA의 이해)&lt;/a&gt; 글을 읽어보고, MSA에 대해서 관심을 가진 적이 있었다. 하지만 MSA에 대해서 약간의 개념 지식만 있을 뿐, 실제 어떻게 구현하는지에 대해서는 자세히 알지 못했다. 그런데 최근에 시간이 남아서(…Looking for new job…ㅜㅜ), Spring 관련 프로젝트들의 튜토리얼을 따라하고 테스트해보다가, &lt;a href=&quot;https://spring.io/guides/tutorials/spring-security-and-angular-js/&quot;&gt;Spring Security and Angular JS&lt;/a&gt;를 보게 되었는데 Spring-cloud를 사용해서 reverse proxy 역할을 하는 API Gateway를 쉽게 만들고, 그 뒤(Back-end)에 서로 다른 역할을 하는 여러 개의 애플리케이션을 만드는 내용이 있어서 잊어버리기 전에 간단하게 정리를 해보려고 한다.&lt;/p&gt;

&lt;p&gt;여기에서 정리하는 내용은 위 레퍼런스의 &lt;a href=&quot;https://spring.io/guides/tutorials/spring-security-and-angular-js/#_multiple_ui_applications_and_a_gateway_single_page_application_with_spring_and_angular_js_part_vi&quot;&gt;Part VI. Multiple UI Applications and a Gateway&lt;/a&gt;에 해당되는 내용이다.&lt;/p&gt;

&lt;p&gt;위의 레퍼런스에도 나와있듯이 만들어보고자 하는 아키텍쳐는 아래와 같다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/dsyer/spring-security-angular/master/double/double-simple.png&quot; alt=&quot;image1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;위의 아키텍처에 대해서 간단하게 이야기해보면, 브라우저(Front-end)의 모든 요청은 Gateway 애플리케이션으로 간다. 그리고 이 Gateway 애플리케이션에서 주로 하는 일 중 하나는 인증(authentication)과 관련된 일이다. 여기에서 인증이 성공되고 난 후에는, &lt;a href=&quot;http://docs.spring.io/spring-session/docs/current/reference/html5/&quot;&gt;Spring-Session&lt;/a&gt;을 사용해서 Redis에 사용자에 대한 정보가 담긴 세션을 저장한다. 그리고 이어지는 Back-end(UI 애플리케이션, RESOURCE 애플리케이션)에 대한 요청에 대해서는 Redis에 저장된 세션정보를 공유하여 인증을 통과하도록 구현한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;실제 레퍼런스에서는 AngularJS를 사용하였고, 쿠키를 사용해서 사용자 인증을 진행했다. 하지만 여기에서는 간단하게 curl로 테스트를 진행하기 위해 &lt;a href=&quot;http://docs.spring.io/spring-session/docs/current/reference/html5/guides/rest.html&quot;&gt;Spring Session REST&lt;/a&gt;를 사용할 것이고, AngularJS는 사용하지 않을 것이다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;1-resource-애플리케이션-만들기&quot;&gt;1. RESOURCE 애플리케이션 만들기&lt;/h1&gt;

&lt;p&gt;요청한 데이터를 전달해주기 위한 역할을 하는 RESOURCE 애플리케이션을 만들기 위해서, 새로운 모듈(새로운 프로젝트)을 만들어준다. IntelliJ와 &lt;a href=&quot;https://start.spring.io&quot;&gt;Spring Initializr&lt;/a&gt;를 사용했다. Spring Initializr를 통해서 Security, Session, Web, Redis, Lombok를 선택해줬다.&lt;/p&gt;

&lt;p&gt;생성된 pom.xml은 아래와 같다.&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-redis&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.projectlombok&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;lombok&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.16.6&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-security&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.session&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-session&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-web&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;완성된 RESOURCE 애플리케이션의 전체적인 구조는 아래와 같으며, 다운받을 수 있도록 &lt;a href=&quot;https://github.com/umsh86/springCloudTutorial/tree/master/resource&quot;&gt;Github&lt;/a&gt;에 올려 놓았다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1261904/15666014/55e1cb40-2749-11e6-96cd-60df05c74ebe.png&quot; alt=&quot;image1&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;11-테스트를-위한-controller-만들기&quot;&gt;1.1. 테스트를 위한 Controller 만들기&lt;/h2&gt;

&lt;p&gt;요청한 리소스를 전달해주기 위한 ResourceController를 생성한다. 전체 내용은 아래와 같다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Slf4j&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ResourceController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;welcome&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Welcome. RESOURCE SERVER&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Principal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LinkedHashMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;roles&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AuthorityUtils&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;authorityListToSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Authentication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getAuthorities&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;postMethodTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;RESOURCE SERVER. POST METHOD.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;테스트를 위해서 3가지 메소드를 만들었다.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;인증없이도 모두 접근이 가능한 내용을 테스트 하기 위해서 welcome( ) 메소드를 만들었다.&lt;/li&gt;
  &lt;li&gt;GET 요청을 테스트 하기 위해서 getUser(Principal user) 메소드를 만들었고, 인증(로그인)한 유저에 대한 정보를 보여줄 것이다.&lt;/li&gt;
  &lt;li&gt;POST 요청을 테스트 하기 위해서 postMethodTest( ) 메소드를 만들었고, 간단하게 메시지만 전달해주는 역할을 한다.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;12-spring-session-설정&quot;&gt;1.2. Spring Session 설정&lt;/h2&gt;

&lt;p&gt;위에서 말했듯이, 인증된 정보를 Spring Session을 이용해서 Redis에 저장하기 위해 관련 설정을 해준다. 설정에 대한 자세한 내용은 &lt;a href=&quot;http://docs.spring.io/spring-session/docs/current/reference/html5/&quot;&gt;Spring-Session&lt;/a&gt;을 참고하면 되고, 간단하게 몇가지만 설명하고 넘어가겠다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableRedisHttpSession&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HttpSessionConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JedisConnectionFactory&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;connectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JedisConnectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpSessionStrategy&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;httpSessionStrategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HeaderHttpSessionStrategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@EnableRedisHttpSession&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;Filter&lt;/code&gt;를 구현한 &lt;code class=&quot;highlighter-rouge&quot;&gt;springSessionRepositoryFilter&lt;/code&gt;라는 이름의 Spring Bean을 생성한다. 이 필터는 HttpSession 구현체를 Spring Session 으로 교체하는 역할을 하고, 이 Spring Session은 Redis에 저장된다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;connectionFactory( ) : RedisConnectionFactory를 생성해서 Spring Session을 Redis서버와 연결시킨다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;HeaderHttpSessionStrategy( ) : 기본적으로 Session에 대한 정보를 전달하기 위해서 쿠키를 사용하는데, HttpSession을 커스터마이징해서 Http Header를 사용해서 Session 정보를 전달하도록 한다.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;production 환경에서는 아래의 내용을 설정파일(application.yml)에 추가하여 접속 정보를 변경할 수 있다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;spring:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;redis:&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;host:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;localhost&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;port:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secret&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;password:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6379&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;13-spring-security-설정&quot;&gt;1.3. Spring Security 설정&lt;/h2&gt;

&lt;p&gt;”/” 요청에 대해서는 모두 접근이 가능하도록 설정을 하고, 나머지 요청에 대해서는 “USER” 권한이 있는 사용자들만 접근이 가능하도록 설정해준다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SecurityConfig&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebSecurityConfigurerAdapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpSecurity&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;httpBasic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;csrf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;disable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;authorizeRequests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;antMatchers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;permitAll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;hasRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;USER&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;14-스프링-설정파일applicationyml-생성&quot;&gt;1.4. 스프링 설정파일(application.yml) 생성&lt;/h2&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;server:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;port:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9000&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;security:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;sessions:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;never&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;server.port&lt;/code&gt; : 간단히 말하면 애플리케이션을 9000번 포트로 실행하겠다는 내용이고, 조금 더 자세하게 설명하자면 이 RESOURCE 애플리케이션으로 들어오는 Http요청을 listen하는 포트를 9000번으로 사용하겠다는 내용이다(어차피 같은 의미).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;security.sessions&lt;/code&gt; : 이 설정을 never로 해주면, 이 RESOURCE 애플리케이션에서는 세션을 절대 생성하지 않는다. 대신에 이미 생성된 세션이 있다면(우리는 gateway에서 인증과 관련된 처리를 하고, 세션을 생성할 예정이므로) 이미 생성된 그 세션을 가져다 사용하라는 의미이다.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;15-redis-설치하기&quot;&gt;1.5. Redis 설치하기&lt;/h2&gt;

&lt;p&gt;Spring Session을 저장하기 위한 저장소로 Redis를 설치한다. &lt;a href=&quot;http://redis.io/download&quot;&gt;http://redis.io/download&lt;/a&gt;에 설치 방법이 잘 나와있다.&lt;/p&gt;

&lt;p&gt;간단하게 명령어 몇가지만 정리해보자면 src 내에서&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;실행 : $ redis-server&lt;/li&gt;
  &lt;li&gt;조회 : $ redis-cli keys ‘*’&lt;/li&gt;
  &lt;li&gt;
    &lt;table&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;전체삭제 : $ redis-cli keys ‘*’&lt;/td&gt;
          &lt;td&gt;xargs redis-cli del&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;정도 이다.&lt;/p&gt;

&lt;h1 id=&quot;2-ui-애플리케이션-admin-애플리케이션-만들기&quot;&gt;2. &lt;del&gt;UI 애플리케이션&lt;/del&gt; ADMIN 애플리케이션 만들기&lt;/h1&gt;

&lt;p&gt;원래는 AngularJS를 사용해서 UI 애플리케이션을 만드는 내용이 있었으나, 관련 내용을 생략하고 ADMIN 애플리케이션을 만들어서 대체하려고 한다(레퍼런스 뒤에 부분에도 ADMIN 애플리케이션을 만들어서 추가하는 부분이 나온다). ADMIN 애플리케이션의 역할은 RESOURCE 애플리케이션과 마찬가지로 요청에 대한 리소스를 전달해주지만, ADMIN 권한이 있는 사용자만 접근이 가능하도록 한다. 대부분의 기능은 RESOURCE 애플리케이션과 같고, Controller에 해당하는 내용만 조금 다르다.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://start.spring.io&quot;&gt;Spring Initializr&lt;/a&gt;를 통해서 Security, Session, Web, Redis, Lombok를 선택하여 새로운 모듈을 만들어준다.&lt;/p&gt;

&lt;p&gt;생성된 pom.xml은 아래와 같다.&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-redis&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.projectlombok&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;lombok&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.16.6&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-security&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.session&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-session&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-web&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;완성된 ADMIN 애플리케이션의 전체적인 구조는 아래와 같으며, 다운받을 수 있도록 &lt;a href=&quot;https://github.com/umsh86/springCloudTutorial/tree/master/admin&quot;&gt;Github&lt;/a&gt;에 올려 놓았다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1261904/15699411/b5d85442-2807-11e6-9e55-a1f2b68b7c6b.png&quot; alt=&quot;image2&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;21-테스트를-위한-controller-만들기&quot;&gt;2.1. 테스트를 위한 Controller 만들기&lt;/h2&gt;

&lt;p&gt;요청한 리소스를 전달해주기 위한 AdminController를 생성한다. GET, POST 요청을 테스트하기 위해서 간단하게 만들었고, 전체 내용은 아래와 같다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AdminController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;welcome&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Welcome. ADMIN SERVER&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;nd&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/time&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getTime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LocalDateTime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;22-spring-session-설정&quot;&gt;2.2. Spring Session 설정&lt;/h2&gt;

&lt;p&gt;위의 &lt;strong&gt;1.2. Spring Session 설정&lt;/strong&gt;의 내용을 참고하면 된다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableRedisHttpSession&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HttpSessionConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JedisConnectionFactory&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;connectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JedisConnectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpSessionStrategy&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;httpSessionStrategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HeaderHttpSessionStrategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;23-spring-security-설정&quot;&gt;2.3. Spring Security 설정&lt;/h2&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SecurityConfig&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebSecurityConfigurerAdapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpSecurity&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;httpBasic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;csrf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;disable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;authorizeRequests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;hasRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ADMIN&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;24-스프링-설정파일applicationyml-생성&quot;&gt;2.4. 스프링 설정파일(application.yml) 생성&lt;/h2&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;server:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;port:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8089&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;security:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;sessions:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;never&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;3-api-gateway-만들기&quot;&gt;3. API Gateway 만들기&lt;/h1&gt;

&lt;p&gt;드디어 이번 글을 정리하는 가장 큰 목적인 API Gateway 이다. 여기서 만드는 수준의 API Gateway 패턴은 수박겉핥기 수준이지만, 어떤 개념인지, Spring-Cloud를 사용해서 어떻게 쉽게 구현할 수 있는지(실제로 사용하기 위해선 턱 없이 부족하지만..)에 대해 맛보는 것만으로 만족하려고 한다.&lt;/p&gt;

&lt;p&gt;우선 &lt;a href=&quot;https://start.spring.io&quot;&gt;Spring Initializr&lt;/a&gt;를 통해서 Security, Session, Web, Redis, Zuul, Lombok를 선택하여 새로운 모듈을 만들어준다.&lt;/p&gt;

&lt;p&gt;생성된 pom.xml은 아래와 같다.&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-zuul&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-redis&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.projectlombok&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;lombok&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.16.6&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-security&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.session&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-session&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-web&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
    
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;완성된 Gateway 애플리케이션의 전체적인 구조는 아래와 같으며, 다운받을 수 있도록 &lt;a href=&quot;https://github.com/umsh86/springCloudTutorial/tree/master/gateway&quot;&gt;Github&lt;/a&gt;에 올려 놓았다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1261904/15701227/ec8d75ec-2813-11e6-90f6-1a3e4e66ef22.png&quot; alt=&quot;image3&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;31-api-gateway로-만들기&quot;&gt;3.1. API Gateway로 만들기&lt;/h2&gt;

&lt;p&gt;이 애플리케이션을 API Gateway로 만들어주기 위해서 GatewayApplication.java에 &lt;code class=&quot;highlighter-rouge&quot;&gt;@EnableZuulProxy&lt;/code&gt; 애노테이션을 추가해준다. 이 Zuul Proxy는 Netflix OSS 중에서 Proxy server 역할을 하는 모듈이다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@SpringBootApplication&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableZuulProxy&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;GatewayApplication&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SpringApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GatewayApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;32-스프링-설정파일applicationyml-생성&quot;&gt;3.2. 스프링 설정파일(application.yml) 생성&lt;/h2&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;zuul:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;routes:&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;resource:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;url:&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;http:&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//localhost:9000&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;admin:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;url:&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;http:&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//localhost:8089&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;security:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;sessions:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;always&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;이것은 /resource/** 의 요청을 외부서버(애플리케이션)인 localhost:9000의 경로로 맵핑시켜주는 작업이다. 마찬가지로, /admin/** 에 해당하는 요청에 대해서는 localhost:8089로 매핑시켜준다.
그리고 인증을 위해서 항상 HttpSession을 생성시키기 위해서 security.sessions을 always로 설정해주었다.&lt;/p&gt;

&lt;h2 id=&quot;33-controller-만들기&quot;&gt;3.3. Controller 만들기&lt;/h2&gt;

&lt;p&gt;GET, POST 요청을 테스트하기 위한 Controller를 생성한다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;GatewayController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;welcome&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Welcome. GATEWAY SERVER.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResponseEntity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;adminCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// TODO : 새로운 ADMIN을 등록하는 내용을 추가한다&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;success.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;34-spring-session-설정&quot;&gt;3.4. Spring Session 설정&lt;/h2&gt;

&lt;p&gt;위에서 했던 것과 똑같이 설정해준다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableRedisHttpSession&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HttpSessionConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JedisConnectionFactory&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;connectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JedisConnectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpSessionStrategy&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;httpSessionStrategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HeaderHttpSessionStrategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;35-spring-security-설정&quot;&gt;3.5. Spring Security 설정&lt;/h2&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SecurityConfig&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebSecurityConfigurerAdapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpSecurity&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;httpBasic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;csrf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;disable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;authorizeRequests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;antMatchers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/resource&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;permitAll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;antMatchers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/admin/**&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;hasRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ADMIN&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;authenticated&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AuthenticationManagerBuilder&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;inMemoryAuthentication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;withUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;roles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;USER&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;withUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;admin&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;admin&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;roles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;USER&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ADMIN&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;gateway의 “/”와 RESOURCE 애플리케이션의 “/” 요청에는 권한이 없어도 모두 접근 가능하도록 했다.&lt;/li&gt;
  &lt;li&gt;“/admin” 으로 시작되는 요청에 대해서는 ADMIN 권한을 가진 사용자만 접근이 가능하도록 설정했다.&lt;/li&gt;
  &lt;li&gt;테스트할 계정을 만들었다.&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;4-테스트&quot;&gt;4. 테스트&lt;/h1&gt;

&lt;p&gt;우선 &lt;code class=&quot;highlighter-rouge&quot;&gt;1.5. Redis 설치하기&lt;/code&gt;를 참고하여 Redis를 실행시킨다.
그리고 각각 &lt;code class=&quot;highlighter-rouge&quot;&gt;$ mvn spring-boot:run&lt;/code&gt; 을 통해서 애플리케이션을 실행시켜준다(다른 방법으로 실행해도 상관없다).&lt;/p&gt;

&lt;h2 id=&quot;41-인증되지-않은-상태에서-요청-테스트&quot;&gt;4.1. 인증되지 않은 상태에서 요청 테스트&lt;/h2&gt;

&lt;p&gt;먼저 &lt;code class=&quot;highlighter-rouge&quot;&gt;$ redis-cli keys '*'&lt;/code&gt; 명령어를 통해서 현재 Redis에 저장된 내용이 있는지 확인한다. 아래와 같이 비어있을 것이다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ redis-cli keys '*'
(empty list or set)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고 Gateway 애플리케이션의 “/” 요청을 테스트해보면 아래와 같이 정상적으로 HttpStatus.OK와 “Welcome. GATEWAY SERVER.” 메시지가 나오는 것을 확인할 수 있다.&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;* Rebuilt URL to: http://localhost:8080/
*   Trying ::1...
* Connected to localhost (::1) port 8080 (#0)
&amp;gt; GET / HTTP/1.1
&amp;gt; Host: localhost:8080
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt;
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Server: Apache-Coyote/1.1
&amp;lt; X-Content-Type-Options: nosniff
&amp;lt; X-XSS-Protection: 1; mode=block
&amp;lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate
&amp;lt; Pragma: no-cache
&amp;lt; Expires: 0
&amp;lt; X-Frame-Options: DENY
&amp;lt; X-Application-Context: application
&amp;lt; Content-Type: text/plain;charset=UTF-8
&amp;lt; Content-Length: 24
&amp;lt; Date: Wed, 01 Jun 2016 07:43:10 GMT
&amp;lt;
* Connection #0 to host localhost left intact
Welcome. GATEWAY SERVER.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고, 또 RESOURCE 애플리케이션의 “/” 요청을 테스트해보았고, 아래와 같이 정상적으로 처리되었다.&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080/resource&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;*   Trying ::1...
* Connected to localhost (::1) port 8080 (#0)
&amp;gt; GET /resource HTTP/1.1
&amp;gt; Host: localhost:8080
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt;
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Server: Apache-Coyote/1.1
&amp;lt; X-Content-Type-Options: nosniff
&amp;lt; X-XSS-Protection: 1; mode=block
&amp;lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate
&amp;lt; Pragma: no-cache
&amp;lt; Expires: 0
&amp;lt; X-Frame-Options: DENY
&amp;lt; X-Application-Context: application
&amp;lt; Date: Wed, 01 Jun 2016 07:49:56 GMT
&amp;lt; Content-Type: text/plain;charset=UTF-8
&amp;lt; Transfer-Encoding: chunked
&amp;lt;
* Connection #0 to host localhost left intact
Welcome. RESOURCE SERVER
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;42-user-권한을-가진-사용자로-인증-후-테스트&quot;&gt;4.2. USER 권한을 가진 사용자로 인증 후 테스트&lt;/h2&gt;

&lt;p&gt;먼저, 인증을 진행했다.&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080 -u user:password&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;* Rebuilt URL to: http://localhost:8080/
*   Trying ::1...
* Connected to localhost (::1) port 8080 (#0)
* Server auth using Basic with user 'user'
&amp;gt; GET / HTTP/1.1
&amp;gt; Host: localhost:8080
&amp;gt; Authorization: Basic dXNlcjpwYXNzd29yZA==
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt;
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Server: Apache-Coyote/1.1
&amp;lt; X-Content-Type-Options: nosniff
&amp;lt; X-XSS-Protection: 1; mode=block
&amp;lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate
&amp;lt; Pragma: no-cache
&amp;lt; Expires: 0
&amp;lt; X-Frame-Options: DENY
&amp;lt; X-Application-Context: application
&amp;lt; x-auth-token: 605b1dc8-c804-4973-94a3-06ae17b6f1f9
&amp;lt; Content-Type: text/plain;charset=UTF-8
&amp;lt; Content-Length: 24
&amp;lt; Date: Wed, 01 Jun 2016 07:55:48 GMT
&amp;lt;
* Connection #0 to host localhost left intact
Welcome. GATEWAY SERVER.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;그리고, 생성된 x-auth-token을 헤더에 설정해주고 RESOURCE 애플리케이션의 “/user” 에 요청을 했다.&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080/resource/user -H “x-auth-token: 605b1dc8-c804-4973-94a39”&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;*   Trying ::1...
* Connected to localhost (::1) port 8080 (#0)
&amp;gt; GET /resource/user HTTP/1.1
&amp;gt; Host: localhost:8080
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt; x-auth-token: 605b1dc8-c804-4973-94a3-06ae17b6f1f9
&amp;gt;
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Server: Apache-Coyote/1.1
&amp;lt; X-Content-Type-Options: nosniff
&amp;lt; X-XSS-Protection: 1; mode=block
&amp;lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate
&amp;lt; Pragma: no-cache
&amp;lt; Expires: 0
&amp;lt; X-Frame-Options: DENY
&amp;lt; X-Application-Context: application
&amp;lt; Date: Wed, 01 Jun 2016 07:56:58 GMT
&amp;lt; Content-Type: application/json;charset=UTF-8
&amp;lt; Transfer-Encoding: chunked
&amp;lt;
* Connection #0 to host localhost left intact
{&quot;name&quot;:&quot;user&quot;,&quot;roles&quot;:[&quot;ROLE_USER&quot;]}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;POST 요청도 테스트해보았다.&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080/resource/user -H “x-auth-token: 605b1dc8-c804-4973-94a3-06ae17b6f1f9” -X POST&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;*   Trying ::1...
* Connected to localhost (::1) port 8080 (#0)
&amp;gt; POST /resource/user HTTP/1.1
&amp;gt; Host: localhost:8080
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt; x-auth-token: 605b1dc8-c804-4973-94a3-06ae17b6f1f9
&amp;gt;
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Server: Apache-Coyote/1.1
&amp;lt; X-Content-Type-Options: nosniff
&amp;lt; X-XSS-Protection: 1; mode=block
&amp;lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate
&amp;lt; Pragma: no-cache
&amp;lt; Expires: 0
&amp;lt; X-Frame-Options: DENY
&amp;lt; X-Application-Context: application
&amp;lt; Date: Wed, 01 Jun 2016 07:58:02 GMT
&amp;lt; Content-Type: text/plain;charset=UTF-8
&amp;lt; Transfer-Encoding: chunked
&amp;lt;
* Connection #0 to host localhost left intact
RESOURCE SERVER. POST METHOD.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;redis-cli keys '*'&lt;/code&gt; 명령어로 Redis 저장소를 확인했더니, 정상적으로 Session이 저장되어있는 것을 볼 수 있었다.&lt;/p&gt;

&lt;p&gt;$ redis-cli keys ‘*’&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1) &quot;spring:session:sessions:605b1dc8-c804-4973-94a3-06ae17b6f1f9&quot;
2) &quot;spring:session:expirations:1464769740000&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;USER 권한을 가지고 있지만, ADMIN 애플리케이션의 “/time”을 요청해보았다.&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080/admin/time -H “x-auth-token: 605b1dc8-c804-4973-94a3-06ae17b6f1f9” -X POST&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Trying ::1... -X POST
* Connected to localhost (::1) port 8080 (#0)
&amp;gt; POST /admin/time HTTP/1.1
&amp;gt; Host: localhost:8080
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt; x-auth-token: 605b1dc8-c804-4973-94a3-06ae17b6f1f9
&amp;gt;
&amp;lt; HTTP/1.1 403 Forbidden
&amp;lt; Server: Apache-Coyote/1.1
&amp;lt; X-Content-Type-Options: nosniff
&amp;lt; X-XSS-Protection: 1; mode=block
&amp;lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate
&amp;lt; Pragma: no-cache
&amp;lt; Expires: 0
&amp;lt; X-Frame-Options: DENY
&amp;lt; Content-Type: application/json;charset=UTF-8
&amp;lt; Transfer-Encoding: chunked
&amp;lt; Date: Wed, 01 Jun 2016 08:02:18 GMT
&amp;lt;
* Connection #0 to host localhost left intact
{&quot;timestamp&quot;:1464768138007,&quot;status&quot;:403,&quot;error&quot;:&quot;Forbidden&quot;,&quot;message&quot;:&quot;Access is denied&quot;,&quot;path&quot;:&quot;/admin/time&quot;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;로그아웃 후 Session이 정상적으로 삭제되었는지 확인해보았다.&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080/logout -H “x-auth-token: 605b1dc8-c804-4973-94a3-06ae17b6f1f9”&lt;/p&gt;

&lt;p&gt;$ redis-cli keys ‘*’&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1) &quot;spring:session:expirations:1464769980000&quot;&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;43-admin-권한을-가진-사용자로-인증-후-테스트&quot;&gt;4.3. ADMIN 권한을 가진 사용자로 인증 후 테스트&lt;/h2&gt;

&lt;p&gt;ADMIN권한을 가진 계정으로 인증을 진행하고, ADMIN 애플리케이션의 “/time” 요청을 재시도 해보았다.&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080/ -u admin:admin&lt;/p&gt;

&lt;p&gt;$ curl -v http://localhost:8080/admin/time -H “x-auth-token: c0f59591-addb-489f-ba55-c1a32e81a0a2” -X POST&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;*   Trying ::1...
* Connected to localhost (::1) port 8080 (#0)
&amp;gt; POST /admin/time HTTP/1.1
&amp;gt; Host: localhost:8080
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt; x-auth-token: c0f59591-addb-489f-ba55-c1a32e81a0a2
&amp;gt;
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Server: Apache-Coyote/1.1
&amp;lt; X-Content-Type-Options: nosniff
&amp;lt; X-XSS-Protection: 1; mode=block
&amp;lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate
&amp;lt; Pragma: no-cache
&amp;lt; Expires: 0
&amp;lt; X-Frame-Options: DENY
&amp;lt; X-Application-Context: application
&amp;lt; Date: Wed, 01 Jun 2016 08:12:12 GMT
&amp;lt; Content-Type: application/json;charset=UTF-8
&amp;lt; Transfer-Encoding: chunked
&amp;lt;
* Connection #0 to host localhost left intact
{&quot;year&quot;:2016,&quot;month&quot;:&quot;JUNE&quot;,&quot;dayOfMonth&quot;:1,&quot;dayOfWeek&quot;:&quot;WEDNESDAY&quot;,&quot;dayOfYear&quot;:153,&quot;monthValue&quot;:6,&quot;hour&quot;:17,&quot;minute&quot;:12,&quot;second&quot;:11,&quot;nano&quot;:961000000,&quot;chronology&quot;:{&quot;id&quot;:&quot;ISO&quot;,&quot;calendarType&quot;:&quot;iso8601&quot;}}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;5-정리&quot;&gt;5. 정리&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;https://spring.io/guides/tutorials/spring-security-and-angular-js/&quot;&gt;Spring Security and Angular JS&lt;/a&gt; 레퍼런스에 나온대로 Spring Cloud의 Zuul Proxy를 사용해서 간단한 API Gateway 패턴을 따라해본 내용을 잊어먹기 전에 정리해보았다. Spring Cloud를 사용해서 MSA를 구현하기에는 턱없이 부족한 내용이고, 제대로 이해하지 못한 부분이나 틀린 부분이 있을 수 있지만, 오랜만에 흥미로운 부분을 건드려본 것 같다. 혹시 나중에 기회가 된다면 조금 더 자세하게 다뤄봐야겠다.&lt;/p&gt;

</description>
        <pubDate>Mon, 30 May 2016 00:00:00 +0000</pubDate>
        <link>http://blog.eomdev.com/java/2016/05/30/API-Gateway.html</link>
        <guid isPermaLink="true">http://blog.eomdev.com/java/2016/05/30/API-Gateway.html</guid>
        
        
        <category>java</category>
        
      </item>
    
      <item>
        <title>Multi Thread(멀티 스레드)에 대하여</title>
        <description>&lt;p&gt;이번에 Java를 전체적으로 다시 한 번 보는데에는, Java8에 추가된 것들을 보기 위한 목적도 있지만 업무를 진행하면서 제대로 경험해보지 못했고, 내 자신이 가장 약하다고 생각되는 부분인 스레드, 네트워크, 파일 입출력에 대한 부분을
다시 확인해보고자 하는 것도 있었다. 그 중에 이번에는 Thread와 관련된 부분을 전체적으로 정리 하려고 한다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;* 목차
1. 멀티 스레드 개념
2. 작업 스레드 생성과 실행
3. 스레드 우선순위
4. 동기화 메소드와 동기화 블록
5. 스레드 상태
6. 스레드 상태 제어
7. 데몬 스레드
8. 스레드 그룹
9. 스레드 풀
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;1-멀티-스레드-개념&quot;&gt;1. 멀티 스레드 개념&lt;/h1&gt;

&lt;h2 id=&quot;11-프로세스와-스레드&quot;&gt;1.1. 프로세스와 스레드&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;프로세스(Process) : 실행 중인 하나의 애플리케이션(애플리케이션인 Chrome 브라우저를 두 개 실행 시키면, 두 개의 Chrome Process가 생성된 것)&lt;/li&gt;
  &lt;li&gt;멀티 스레드(Multi thread) : 하나의 Process가 두 가지 이상의 작업을 처리할 수 있도록 하는 것.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;12-메인-스레드&quot;&gt;1.2. 메인 스레드&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;자바 애플리케이션은 메인 스레드가 main( ) 메소드를 실행하면서 시작됨.&lt;/li&gt;
  &lt;li&gt;메인 스레드에서 다른 작업 스레드들을 만들어서 실행할 수 있으며, 모든 스레드가 종료되어야 프로세스가 종료됨.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;2-작업-스레드-생성과-실행&quot;&gt;2. 작업 스레드 생성과 실행&lt;/h1&gt;

&lt;h2 id=&quot;21-작업-스레드-생성과-실행&quot;&gt;2.1. 작업 스레드 생성과 실행&lt;/h2&gt;

&lt;h3 id=&quot;211-javalangthread-클래스로부터-직접-생성&quot;&gt;2.1.1. java.lang.Thread 클래스로부터 직접 생성&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Runnable 인터페이스를 구현하는 방법.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// 스레드가 실행할 코드;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;익명 구현 객체를 사용하는 방법&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// 스레드가 실행할 코드;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Java8의 람다식을 사용하는 방법&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(()-&amp;gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// 스레드가 실행할 코드;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Thread 시작&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;212-thread-하위-클래스로부터-생성&quot;&gt;2.1.2. Thread 하위 클래스로부터 생성&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Thread 클래스를 상속한 후 run( ) 메소드를 재정의 하는 방법이다.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;myThread&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// 스레드가 실행할 코드&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;아래는 익명 Thread 익명 객체로 생성하는 방법이다.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// 스레드가 실행할 코드&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;213-스레드의-이름&quot;&gt;2.1.3. 스레드의 이름&lt;/h3&gt;

&lt;p&gt;Thread 클래스의 setName(“스레드 이름”) 메소드를 사용해서 변경하면 된다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;스레드 이름&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// 스레드 이름 설정&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;             &lt;span class=&quot;c1&quot;&gt;// 스레드의 이름 가져오기&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;현재 스레드의 객체 참조를 얻는 방법이다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;3-스레드-우선순위&quot;&gt;3. 스레드 우선순위&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;동시